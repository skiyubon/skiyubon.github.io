<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>MyBatis | Skiyubon&#39;s	Blog</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="MyBatis" />
    
    <meta name="description" content="MyBatis 是一个简化和实现了 Java 数据持久化层(persistence layer)的开源框架，它抽象了大量的 JDBC 冗余代码，并提供了一个简单易用的 API 和数据库交互。MyBatis 的前身是 iBATIS，iBATIS 于 2002 年由 Clinton Begin 创建。 MyBatis 3 是 iBATIS 的全新设计，支持注解和 Mapper。MyBatis 流行的主">
<meta name="keywords" content="MyBatis">
<meta property="og:type" content="article">
<meta property="og:title" content="MyBatis">
<meta property="og:url" content="https://skiyubon.github.io/2017/04/13/MyBatis/index.html">
<meta property="og:site_name" content="Skiyubon&#39;s	Blog">
<meta property="og:description" content="MyBatis 是一个简化和实现了 Java 数据持久化层(persistence layer)的开源框架，它抽象了大量的 JDBC 冗余代码，并提供了一个简单易用的 API 和数据库交互。MyBatis 的前身是 iBATIS，iBATIS 于 2002 年由 Clinton Begin 创建。 MyBatis 3 是 iBATIS 的全新设计，支持注解和 Mapper。MyBatis 流行的主">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2017-04-15T08:27:21.497Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MyBatis">
<meta name="twitter:description" content="MyBatis 是一个简化和实现了 Java 数据持久化层(persistence layer)的开源框架，它抽象了大量的 JDBC 冗余代码，并提供了一个简单易用的 API 和数据库交互。MyBatis 的前身是 iBATIS，iBATIS 于 2002 年由 Clinton Begin 创建。 MyBatis 3 是 iBATIS 的全新设计，支持注解和 Mapper。MyBatis 流行的主">
    

    
        <link rel="alternate" href="/" title="Skiyubon&#39;s	Blog" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.0.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    


</head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">index.home</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Cache/">Cache</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/JS/">JS</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Java/">Java</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/JavaWeb/">JavaWeb</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Security/">Security</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Tool/">Tool</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/大数据/">大数据</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/软件架构/">软件架构</a></li></ul>
                                    
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/about/index.html">index.about</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="index.search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="insight.hint" />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'insight.posts',
            PAGES: 'insight.pages',
            CATEGORIES: 'insight.categories',
            TAGS: 'insight.tags',
            UNTITLED: 'insight.untitled',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/JavaWeb/">JavaWeb</a>
    </h1>
</div>
                        <div class="main-body-content">
                            <article id="post-MyBatis" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        MyBatis
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
        <a href="/2017/04/13/MyBatis/" class="article-date">
            <time datetime="2017-04-13T02:27:08.000Z" itemprop="datePublished">2017-04-13</time>
        </a>
    </div>

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/MyBatis/">MyBatis</a>
    </div>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <p>MyBatis 是一个简化和实现了 Java 数据持久化层(persistence layer)的开源框架，它抽象了大量的 JDBC 冗余代码，并提供了一个简单易用的 API 和数据库交互。<br>MyBatis 的前身是 iBATIS，iBATIS 于 2002 年由 Clinton Begin 创建。 MyBatis 3 是 iBATIS 的全新设计，支持注解和 Mapper。<br>MyBatis 流行的主要原因在于它的简单性和易使用性。在 Java 应用程序中，数据持久化层涉及到的工作有：将从数<br>据库查询到的数据生成所需要的 Java 对象；将 Java 对象中的数据通过 SQL 持久化到数据库中。<br>MyBatis 通过抽象底层的 JDBC 代码，自动化 SQL 结果集产生 Java 对象、 Java 对象的数据持久化数据库中的过程使得对 SQL 的使用变得容易。<br>如 果 你 正 在 使 用 iBATIS ， 并 且 想 将 iBATIS 移 植 到 MyBatis 上 ， 你 可 以 在 MyBatis 的 官 方 网 站（ <a href="https://code.google.com/p/mybatis/wiki/DocUpgrade" target="_blank" rel="noopener">https://code.google.com/p/mybatis/wiki/DocUpgrade</a> ）上找到详细的指导步骤。<br><a id="more"></a></p>
<h1 id="为什么选择-MyBatis？"><a href="#为什么选择-MyBatis？" class="headerlink" title="为什么选择 MyBatis？"></a>为什么选择 MyBatis？</h1><p>当前有很多 Java 实现的持久化框架，而 MyBatis 流行起来有以下原因：</p>
<ul>
<li>它消除了大量的 JDBC 冗余代码</li>
<li>它有低的学习曲线</li>
<li>它能很好地与传统数据库协同工作</li>
<li>它可以接受 SQL 语句</li>
<li>它提供了与 Spring 和 Guice 框架的集成支持</li>
<li>它提供了与第三方缓存类库的集成支持</li>
<li>它引入了更好的性能</li>
</ul>
<h2 id="消除大量的-JDBC-冗余代码"><a href="#消除大量的-JDBC-冗余代码" class="headerlink" title="消除大量的 JDBC 冗余代码"></a>消除大量的 JDBC 冗余代码</h2><p>你不需要创建 Connection 连接，PreparedStatement，不需要自己对每一次数据库操作进行手动设置参数和关闭连接。只需要配置数据库连接属性和 SQL 语句，MyBatis 会处理这些底层工作。</p>
<p>另外，MyBatis 还提供了其他的一些特性来简化持久化逻辑的实现:</p>
<ul>
<li>它支持复杂的 SQL 结果集数据映射到嵌套对象图结构</li>
<li>它支持一对一和一对多的结果集和 Java 对象的映射</li>
<li>它支持根据输入的数据构建动态的 SQL 语句</li>
</ul>
<h2 id="能够很好地与传统数据库协同工作"><a href="#能够很好地与传统数据库协同工作" class="headerlink" title="能够很好地与传统数据库协同工作"></a>能够很好地与传统数据库协同工作</h2><p>有时我们可能需要用不正规形式与传统数据库协同工作，使用成熟的 ORM 框架（如 Hibernate）有可能、 但是很难跟传统数据库很好地协同工作，因为他们尝试将 Java 对象静态地映射到数据库的表上。<br>而 MyBatis 是将查询的结果与 Java 对象映射起来，这使得 MyBatis 可以很好地与传统数据库协同工作。你可以根据面相对象的模型创建 Java 域对象，执行传统数据库的查询，然后将结果映射到对应的 Java 对象上。</p>
<h2 id="接受-SQL"><a href="#接受-SQL" class="headerlink" title="接受 SQL"></a>接受 SQL</h2><p>成熟的 ORM 框架（如 Hibernate）鼓励使用实体对象（Entity Objects）和在其底层自动产生 SQL 语句。由于这种的 SQL 生成方式，我们有可能不能够利用到数据库的一些特有的特性。 Hibernate 允许执行本地SQL，但是这样会打破持久层和数据库独立的原则。<br>MyBatis 框架接受 SQL 语句，而不是将其对开发人员隐藏起来。由于 MyBatis 不会产生任何的 SQL 语句，所以开发人员就要准备 SQL 语句，这样就可以充分利用数据库特有的特性并且可以准备自定义的查询。另外，MyBatis 对存储过程也提供了支持。</p>
<h2 id="与-Spring-和-Guice-框架的集成支持"><a href="#与-Spring-和-Guice-框架的集成支持" class="headerlink" title="与 Spring 和 Guice 框架的集成支持"></a>与 Spring 和 Guice 框架的集成支持</h2><p>MyBatis 提供了与 流行的依赖注入框架 Spring 和 Guice 的开包即用的集成支持，这将进一步简化 MyBatis 的使用</p>
<h2 id="与第三方缓存类库的集成支持"><a href="#与第三方缓存类库的集成支持" class="headerlink" title="与第三方缓存类库的集成支持"></a>与第三方缓存类库的集成支持</h2><p>MyBatis 有内建的 SqlSession 级别的缓存机制，用于缓存 Select 语句查询出来的结果。除此之外，MyBatis 提供了与多种第三方缓存类库的集成支持，如 EHCache，OSCache，Hazelcast。</p>
<h2 id="良好的性能"><a href="#良好的性能" class="headerlink" title="良好的性能"></a>良好的性能</h2><p>性能问题是关乎软件应用成功与否的关键因素之一。为了达到更好的性能，需要考虑很多事情，而对很多应用而言，数据持久化层是整个系统性能的关键。<br>MyBatis 支持数据库连接池，消除了为每一个请求创建一个数据库连接的开销<br>MyBatis 提供了内建的缓存机制，在 SqlSession 级别提供了对 SQL 查询结果的缓存。即:如果你调用了相同的select 查询，MyBatis 会将放在缓存的结果返回，而不会去再查询数据库。<br>MyBatis 框架并没有大量地使用代理机制2，因此对于其他的过度地使用代理的 ORM 框架而言，MyBatis 可以获得更好的性能。</p>
<p>在软件开发中，并没有通用的（一体适用）的解决方案，每一个应用会有不同的一系列的要求，而我们应该根据应用的需要来选择我们的工具和框架。在前一节中，我们看到了使用 MyBatis 的优点。然而也有一些情况，MyBatis 并不是理想的或者是最好的解决方案。<br>如果你的应用是以面向对象模型，并且向动态生成 SQL 语句，那么 MyBatis可能就不符合你的要求。另外，如果你想让你的应用有一个传递性的缓存机制的话（保存父对象时也应该保存关联的子对象），Hibernate 会更适合你。</p>
<h1 id="MyBatis入门（安装和配置简单示例）"><a href="#MyBatis入门（安装和配置简单示例）" class="headerlink" title="MyBatis入门（安装和配置简单示例）"></a>MyBatis入门（安装和配置简单示例）</h1><ol>
<li>新建一个 Java 项目，将 MyBatis-3.2.2.jar 添加到 classpath 中</li>
<li>新建 mybatis-config.xml 和映射器 StudentMapper.xml 配置文件</li>
<li><p>新建 MyBatisSqlSessionFactory 单例类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisSqlSessionFactory</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SqlSessionFactory <span class="title">getSqlSessionFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (sqlSessionFactory == <span class="keyword">null</span>) &#123;</span><br><span class="line">			InputStream inputStream;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				inputStream = Resources.getResourceAsStream(<span class="string">"mybatis-config.xml"</span>);	<span class="comment">//加载核心配置文件</span></span><br><span class="line">				sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);	<span class="comment">//生成SqlSessionFactory</span></span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e.getCause());</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> sqlSessionFactory;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title">openSession</span><span class="params">()</span> </span>&#123;					<span class="comment">//从sqlSessionFactory中获取SqlSession</span></span><br><span class="line">		<span class="keyword">return</span> getSqlSessionFactory().openSession();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 StudentMapper 接口和 StudentService 类</p>
</li>
<li>新建一个 JUnit 测试类来测试 StudentService</li>
</ol>
<h2 id="它是怎么工作的"><a href="#它是怎么工作的" class="headerlink" title="它是怎么工作的"></a>它是怎么工作的</h2><p>首先，我们配置了 MyBatis 最主要的配置文件-mybatis-config.xml,里面包含了 JDBC 连接参数；配置了映射器Mapper XML 配置文件文件，里面包含了 SQL 语句的映射。<br>我们使用 mybatis-config.xml 内的信息创建了 SqlSessionFactory 对象。每个数据库环境应该就一个SqlSessionFactory 对象实例，所以我们使用了单例模式只创建一个 SqlSessionFactory 实例。我们创建了一个映射器 Mapper 接口-StudentMapper，其定义的方法签名和在 StudentMapper.xml 中定义的完全一样（即映射器 Mapper 接口中的方法名跟 StudentMapper.xml 中的 id 的值相同）。注意StudentMapper.xml 中namespace 的值被设置成com.mybatis3.mappers.StudentMapper，是StudentMapper 接口的完全限定名。这使我们可以使用接口来调用映射的 SQL 语句。<br>在 StudentService.java 中，我们在每一个方法中创建了一个新的 SqlSession，并在方法功能完成后关闭SqlSession。每一个线程应该有它自己的 SqlSession 实例。 SqlSession 对象实例不是线程安全的，并且不被共享。所以 SqlSession 的作用域最好就是其所在方法的作用域。从 Web 应用程序角度上看，SqlSession 应该存在于 request 级别作用域上。</p>
<h1 id="MyBatis的配置元素和SqlSessionFactory"><a href="#MyBatis的配置元素和SqlSessionFactory" class="headerlink" title="MyBatis的配置元素和SqlSessionFactory"></a>MyBatis的配置元素和SqlSessionFactory</h1><p>MyBatis 最关键的组成部分是 SqlSessionFactory，我们可以从中获取 SqlSession，并执行映射的 SQL 语句。<br>SqlSessionFactory 对象可以通过基于 XML 的配置信息或者 Java API 创建。<br>我们将探索各种 MaBatis 配置元素，如 dataSource，environments,全局参数设置,typeAlias，typeHandlers，SQL 映射；接着我们将实例化 SqlSessionFactory。</p>
<h2 id="使用XML配置MyBatis"><a href="#使用XML配置MyBatis" class="headerlink" title="使用XML配置MyBatis"></a>使用XML配置MyBatis</h2><p>构建 SqlSessionFactory 最常见的方式是基于 XML 配置（的构造方式）。下面的 mybatis-config.xml 展示了一个典型的 MyBatis 配置文件的样子：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="meta">"http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"application.properties"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"db_user"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"verysecurepwd"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"cacheEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Tutor"</span> <span class="attr">type</span>=<span class="string">"com.mybatis3.domain.Tutor"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.mybatis3.domain"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">"com.mybatis3.typehandlers. PhoneTypeHandler"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.mybatis3.typehandlers"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driverClassName&#125;"</span> /&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span> /&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span> /&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"production"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"MANAGED"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"JNDI"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"data_source"</span> <span class="attr">value</span>=<span class="string">"java:comp/jdbc/MyBatisDemoDS"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"com/mybatis3/mappers/StudentMapper.xml"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">"file:///D:/mybatisdemo/mappers/TutorMapper.xml"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">"com.mybatis3.mappers.TutorMapper"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="environment"><a href="#environment" class="headerlink" title="environment"></a>environment</h3><p>MyBatis 支持配置多个 dataSource 环境，可以将应用部署到不同的环境上，如 DEV(开发环境)，TEST（测试换将），QA（质量评估环境）,UAT(用户验收环境),PRODUCTION（生产环境），可以通过将默认 environment 值设置成想要的environment id 值。<br>在上述的配置中，默认的环境 environment 被设置成 development。当需要将程序部署到生产服务器上时，你不需<br>要修改什么配置，只需要将默认环境 environment 值设置成生产环境的 environment id 属性即可。<br>有时候，我们可能需要在相同的应用下使用多个数据库。比如我们可能有 SHOPPING-CART 数据库来存储所有的订单<br>明细；使用 REPORTS 数据库存储订单明细的合计，用作报告。<br>如果你的应用需要连接多个数据库，你需要将每个数据库配置成独立的环境，并且为每一个数据库创建一个<br>SqlSessionFactory。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"shoppingcart"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"shoppingcart"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"MANAGED"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"JNDI"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"data_source"</span> <span class="attr">value</span>=<span class="string">"java:comp/jdbc/ ShoppingcartDS"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"reports"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"MANAGED"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"JNDI"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"data_source"</span> <span class="attr">value</span>=<span class="string">"java:comp/jdbc/ReportsDS"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们可以如下为每个环境创建一个 SqlSessionFactory:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">inputStream = Resources.getResourceAsStream(<span class="string">"mybatis-config.xml"</span>);</span><br><span class="line">defaultSqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">cartSqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream, <span class="string">"shoppingcart"</span>);</span><br><span class="line">reportSqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream, <span class="string">"reports"</span>);</span><br></pre></td></tr></table></figure></p>
<p>创建 SqlSessionFactory 时，如果没有明确指定环境 environment id，则会使用默认的环境 environment 来创<br>建。在上述的源码中，默认的 SqlSessionFactory 便是使用 shoppingcart 环境设置创建的。<br>对于每个环境 environment,我们需要配置 dataSource 和 transactionManager 元素。</p>
<h3 id="数据源-DataSource"><a href="#数据源-DataSource" class="headerlink" title="数据源 DataSource"></a>数据源 DataSource</h3><p>dataSource 元素被用来配置数据库连接属性。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driverClassName&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>dataSource 的类型可以配置成其内置类型之一，如 UNPOOLED，POOLED，JNDI。</p>
<ul>
<li>如果将类型设置成 UNPOOLED，MyBatis 会为每一个数据库操作创建一个新的连接，并关闭它。该方式适用于只有小规模数量并发用户的简单应用程序上。</li>
<li>如果将属性设置成 POOLED，MyBatis 会创建一个数据库连接池，连接池中的一个连接将会被用作数据库操作。一旦数据库操作完成，MyBatis 会将此连接返回给连接池。在开发或测试环境中，经常使用此种方式。</li>
<li>如果将类型设置成 JNDI，MyBatis 从在应用服务器向配置好的 JNDI 数据源 dataSource 获取数据库连接。在生产环境中，优先考虑这种方式。</li>
</ul>
<h3 id="事务管理器-TransactionManager"><a href="#事务管理器-TransactionManager" class="headerlink" title="事务管理器 TransactionManager"></a>事务管理器 TransactionManager</h3><p>MyBatis 支持两种类型的事务管理器： JDBC and MANAGED.</p>
<ul>
<li>JDBC 事务管理器被用作当应用程序负责管理数据库连接的生命周期（提交、回退等等）的时候。当你将TransactionManager 属性设置成 JDBC，MyBatis 内部将使用 JdbcTransactionFactory 类创建TransactionManager。例如，部署到 Apache Tomcat 的应用程序，需要应用程序自己管理事务。</li>
<li>MANAGED 事务管理器是当由应用服务器负责管理数据库连接生命周期的时候使用。当你将TransactionManager 属性设置成 MANAGED 时， MyBatis 内部使用 ManagedTransactionFactory 类创建事务管理器TransactionManager。例如，当一个 JavaEE的应用程序部署在类似 JBoss， WebLogic，GlassFish 应用服务器上时，它们会使用 EJB 进行应用服务器的事务管理能力。在这些管理环境中，你可以使用 MANAGED 事务管理器。<br>（译者注：Managed 是托管的意思，即是应用本身不去管理事务，而是把事务管理交给应用所在的服务器进行管理。）</li>
</ul>
<h3 id="属性-Properties"><a href="#属性-Properties" class="headerlink" title="属性 Properties"></a>属性 Properties</h3><p>属性配置元素可以将配置值具体化到一个属性文件中，，并且使用属性文件的 key 名作为占位符。在上述的配置中，我们将数据库连接属性具体化到了 application.properties 文件中，并且为 driver，URL 等属性使用了占位符。</p>
<ol>
<li><p>在 applications.properties 文件中配置数据库连接参数，如下所示：</p>
<p> jdbc.driverClassName=com.mysql.jdbc.Driver<br> jdbc.url=jdbc:mysql://localhost:3306/mybatisdemo<br> jdbc.username=root<br> jdbc.password=admin</p>
</li>
<li><p>在 mybatis-config.xml 文件中，为属性使用 application.properties 文件中定义的占位符：</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"application.properties"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbc.username"</span> <span class="attr">value</span>=<span class="string">"db_user"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbc.password"</span> <span class="attr">value</span>=<span class="string">"verysecurepwd"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driverClassName&#125;"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>并且，你可以在<properties>元素中配置默认参数的值。如果<properties>中定义的元素和属性文件定义元素的 key值相同，它们会被属性文件中定义的值覆盖。</properties></properties></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"application.properties"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbc.username"</span> <span class="attr">value</span>=<span class="string">"db_user"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbc.password"</span> <span class="attr">value</span>=<span class="string">"verysecurepwd"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里，如果 application.properties 文件包含值 jdbc.username 和 jdbc.password，则上述定义的 username 和<br>password 的值 db_user 和 verysecurepwd 将会被 application.properties 中定义的对应的 jdbc.username 和<br>jdbc.password 值覆盖。</p>
<h3 id="类型别名-typeAliases"><a href="#类型别名-typeAliases" class="headerlink" title="类型别名 typeAliases"></a>类型别名 typeAliases</h3><p>在 SQLMapper 配置文件中，对于 resultType 和 parameterType 属性值，我们需要使用 JavaBean 的完全限定名。<br>如下例子所示：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findStudentById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">resultType</span>=<span class="string">"com.mybatis3.domain.Student"</span>&gt;</span></span><br><span class="line">	SELECT STUD_ID AS ID, NAME, EMAIL, DOB</span><br><span class="line">	FROM STUDENTS WHERE STUD_ID=#&#123;Id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateStudent"</span> <span class="attr">parameterType</span>=<span class="string">"com.mybatis3.domain. Student"</span>&gt;</span></span><br><span class="line">	UPDATE STUDENTS</span><br><span class="line">	SET NAME=#&#123;name&#125;, EMAIL=#&#123;email&#125;, DOB=#&#123;dob&#125;</span><br><span class="line">	WHERE STUD_ID=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这里我们为 resultType 和 parameterType 属性值设置为 Student 类型的完全限定名：<br>com.mybatis3.domain.Student<br>我们可以为完全限定名取一个别名（alias），然后其需要使用完全限定名的地方使用别名，而不是到处使用完全限定<br>名。如下例子所示，为完全限定名起一个别名：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Student"</span> <span class="attr">type</span>=<span class="string">"com.mybatis3.domain.Student"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Tutor"</span> <span class="attr">type</span>=<span class="string">"com.mybatis3.domain.Tutor"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.mybatis3.domain"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>然后在 SQL Mapper 映射文件中, 如下使用 Student 的别名：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findStudentById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">	SELECT STUD_ID AS ID, NAME, EMAIL, DOB</span><br><span class="line">	FROM STUDENTS WHERE STUD_ID=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateStudent"</span> <span class="attr">parameterType</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">	UPDATE STUDENTS</span><br><span class="line">	SET NAME=#&#123;name&#125;, EMAIL=#&#123;email&#125;, DOB=#&#123;dob&#125;</span><br><span class="line">	WHERE STUD_ID=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>你可以不用为每一个 JavaBean 单独定义别名, 你可以为提供需要取别名的 JavaBean 所在的包(package)，MyBatis会自动扫描包内定义的 JavaBeans，然后分别为 JavaBean 注册一个小写字母开头的非完全限定的类名形式的别名。如下所示，提供一个需要为 JavaBeans 起别名的包名：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.mybatis3.domain"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>如果 Student.java 和 Tutor.java Bean 定义在 com.mybatis3.domain 包中，则com.mybatis3.domain.Student的别名会被注册为 student。而 com.mybatis3.domain.Tutor 别名将会被注册为 tutor。示例如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Student"</span> <span class="attr">type</span>=<span class="string">"com.mybatis3.domain.Student"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Tutor"</span> <span class="attr">type</span>=<span class="string">"com.mybatis3.domain.Tutor"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.mybatis3.domain"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.mybatis3.webservices.domain"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>还有另外一种方式为 JavaBeans 起别名，使用注解@Alias:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Alias</span>(<span class="string">"StudentAlias"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span></span></span><br><span class="line"><span class="class"></span>&#123; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="类型处理器-typeHandlers"><a href="#类型处理器-typeHandlers" class="headerlink" title="类型处理器 typeHandlers"></a>类型处理器 typeHandlers</h3><p>如上一章已经讨论过，MyBatis 通过抽象 JDBC 来简化了数据持久化逻辑的实现。 MyBatis 在其内部使用 JDBC，提供了更简洁的方式实现了数据库操作。<br>当 MyBatis 将一个 Java 对象作为输入参数执行 INSERT 语句操作时，它会创建一个 PreparedStatement 对象，并且使用 setXXX()方式对占位符设置相应的参数值。<br>这里，XXX 可以是 Int，String，Date 等 Java 对象属性类型的任意一个。示例如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertStudent"</span> <span class="attr">parameterType</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">	INSERT INTO STUDENTS(STUD_ID,NAME,EMAIL,DOB)</span><br><span class="line">	VALUES(#&#123;studId&#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;dob&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>为执行这个语句，MyBatis 将采取以下一系列动作：</p>
<ol>
<li><p>创建一个有占位符的 PreparedStatement 接口，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PreparedStatement pstmt = connection</span><br><span class="line">				.prepareStatement(<span class="string">"INSERT INTO STUDENTS(STUD_ID,NAME,EMAIL,DOB) VALUES(?,?,?,?)"</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>检查 Student 对象的属性 studId 的类型，然后使用合适 setXXX 方法去设置参数值。这里 studId 是 integer类型，所以会使用 setInt()方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pstmt.setInt(<span class="number">1</span>,student.getStudId());</span><br></pre></td></tr></table></figure>
</li>
<li><p>类似地，对于 name 和 email 属性都是 String 类型，MyBatis 使用 setString()方法设置参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pstmt.setString(<span class="number">2</span>, student.getName());</span><br><span class="line">pstmt.setString(<span class="number">3</span>, student.getEmail());</span><br></pre></td></tr></table></figure>
</li>
<li><p>至于 dob 属性, MyBatis 会使用 setDate() 方法设置 dob 处占位符位置的值。</p>
</li>
<li>MyBaits 会将 java.util.Date 类型转换为 into java.sql.Timestamp 并设值：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pstmt.setTimestamp(<span class="number">4</span>, <span class="keyword">new</span> Timestamp((student.getDob()).getTime()));</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>厉害！但 MyBatis 是怎么知道对于 Integer 类型属性使用 setInt() 和 String 类型属性使用 setString()方法呢？<br>其实 MyBatis 是通过使用类型处理器（type handlers）来决定这么做的。<br>MyBatis 对于以下的类型使用内建的类型处理器：所有的基本数据类型、基本类型的包裹类型、 byte[]、<br>java.util.Date、 java.sql.Date、 java,sql.Time、 java.sql.Timestamp、 java 枚举类型等。所以当 MyBatis 发现属性的类型属于上述类型，他会使用对应的类型处理器将值设置到 PreparedStatement 中，同样地，当从 SQL 结果集构建 JavaBean 时，也有类似的过程。<br>那如果我们给了一个自定义的对象类型，来存储存储到数据库呢？示例如下：<br>假设表 STUDENTS 有一个 PHONE 字段，类型为 VARCHAR(15)，而 JavaBean Student 有一个 PhoneNumber 类定义类型的 phoneNumber 属性。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhoneNumber</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String countryCode;</span><br><span class="line">	<span class="keyword">private</span> String stateCode;</span><br><span class="line">	<span class="keyword">private</span> String number;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PhoneNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PhoneNumber</span><span class="params">(String countryCode, String stateCode, String number)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.countryCode = countryCode;</span><br><span class="line">		<span class="keyword">this</span>.stateCode = stateCode;</span><br><span class="line">		<span class="keyword">this</span>.number = number;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PhoneNumber</span><span class="params">(String string)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (string != <span class="keyword">null</span>) &#123;</span><br><span class="line">			String[] parts = string.split(<span class="string">"-"</span>);</span><br><span class="line">			<span class="keyword">if</span> (parts.length &gt; <span class="number">0</span>)</span><br><span class="line">				<span class="keyword">this</span>.countryCode = parts[<span class="number">0</span>];</span><br><span class="line">			<span class="keyword">if</span> (parts.length &gt; <span class="number">1</span>)</span><br><span class="line">				<span class="keyword">this</span>.stateCode = parts[<span class="number">1</span>];</span><br><span class="line">			<span class="keyword">if</span> (parts.length &gt; <span class="number">2</span>)</span><br><span class="line">				<span class="keyword">this</span>.number = parts[<span class="number">2</span>];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getAsString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> countryCode + <span class="string">"-"</span> + stateCode + <span class="string">"-"</span> + number;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Setters and getters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String email;</span><br><span class="line">	<span class="keyword">private</span> PhoneNumber phone;</span><br><span class="line">	<span class="comment">// Setters and getters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertStudent"</span> <span class="attr">parameterType</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">	insert into students(name,email,phone)</span><br><span class="line">	values(#&#123;name&#125;,#&#123;email&#125;,#&#123;phone&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里，phone 参数需要传递给#{phone}；而 phone 对象是 PhoneNumber 类型。然而，MyBatis 并不知道该怎样来处理这个类型的对象。<br>为了让 MyBatis 明白怎样处理这个自定义的 Java 对象类型，如 PhoneNumber，我们可以创建一个自定义的类型处理器，如下所示：</p>
<ol>
<li><p>MyBatis 提供了抽象类 BaseTypeHandler<t> ，我们可以继承此类创建自定义类型处理器。</t></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">packagecom.mybatis3.typehandlers;</span><br><span class="line">importjava.sql.CallableStatement;</span><br><span class="line">importjava.sql.PreparedStatement;</span><br><span class="line">importjava.sql.ResultSet;</span><br><span class="line">importjava.sql.SQLException;</span><br><span class="line">importorg.apache.ibatis.type.BaseTypeHandler;</span><br><span class="line">importorg.apache.ibatis.type.JdbcType;</span><br><span class="line">importcom.mybatis3.domain.PhoneNumber;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhoneTypeHandler</span> <span class="keyword">extends</span> <span class="title">BaseTypeHandler</span>&lt;<span class="title">PhoneNumber</span>&gt; </span>&#123;</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNonNullParameter</span><span class="params">(PreparedStatement ps, <span class="keyword">int</span> i, PhoneNumber parameter, JdbcType jdbcType)</span></span></span><br><span class="line"><span class="function">				<span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">			ps.setString(i, parameter.getAsString());</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> PhoneNumber <span class="title">getNullableResult</span><span class="params">(ResultSet rs, String columnName)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> PhoneNumber(rs.getString(columnName));</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> PhoneNumber <span class="title">getNullableResult</span><span class="params">(ResultSet rs, <span class="keyword">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> PhoneNumber(rs.getString(columnIndex));</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> PhoneNumber <span class="title">getNullableResult</span><span class="params">(CallableStatement cs, <span class="keyword">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> PhoneNumber(cs.getString(columnIndex));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>我们使用 ps.setString()和 rs.getString()方法是因为 phone 列是 VARCHAR 类型。</p>
</li>
<li>一旦我们实现了自定义的类型处理器，我们需要在 mybatis-config.xml 中注册它：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="meta">"http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"application.properties"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">"com.mybatis3.typehandlers. PhoneTypeHandler"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>注册 PhoneTypeHandler 后, MyBatis 就能够将 Phone 类型的对象值存储到 VARCHAR 类型的列上。</p>
<h3 id="全局参数设置-Settings"><a href="#全局参数设置-Settings" class="headerlink" title="全局参数设置 Settings"></a>全局参数设置 Settings</h3><p>为满足应用特定的需求，MyBatis 默认的全局参数设置可以被覆盖(overridden)掉，如下所示：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"cacheEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadingEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"multipleResultSetsEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"useColumnLabel"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"useGeneratedKeys"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"autoMappingBehavior"</span> <span class="attr">value</span>=<span class="string">"PARTIAL"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"defaultExecutorType"</span> <span class="attr">value</span>=<span class="string">"SIMPLE"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"defaultStatementTimeout"</span> <span class="attr">value</span>=<span class="string">"25000"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"safeRowBoundsEnabled"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"mapUnderscoreToCamelCase"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"localCacheScope"</span> <span class="attr">value</span>=<span class="string">"SESSION"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"jdbcTypeForNull"</span> <span class="attr">value</span>=<span class="string">"OTHER"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadTriggerMethods"</span> <span class="attr">value</span>=<span class="string">"equals,clone,hashCode ,toString"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="SQL-映射定义-Mappers"><a href="#SQL-映射定义-Mappers" class="headerlink" title="SQL 映射定义 Mappers"></a>SQL 映射定义 Mappers</h3><p>Mapper XML 文件中包含的 SQL 映射语句将会被应用通过使用其 statementid 来执行。我们需要在mybatisconfig.xml 文件中配置 SQL Mapper 文件的位置。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mappers&gt;</span><br><span class="line">	<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"com/mybatis3/mappers/StudentMapper.xml"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">"file:///D:/mybatisdemo/app/mappers/TutorMapper.xml"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">"com.mybatis3.mappers.TutorMapper"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.mybatis3.mappers"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>以上每一个<mapper> 标签的属性有助于从不同类型的资源中加载映射 mapper：</mapper></p>
<ul>
<li>resource 属性用来指定在 classpath 中的 mapper 文件。</li>
<li>url 属性用来通过完全文件系统路径或者 web URL 地址来指向 mapper 文件</li>
<li>class 属性用来指向一个 mapper 接口</li>
<li>package 属性用来指向可以找到 Mapper 接口的包名</li>
</ul>
<h2 id="使用Java-API配置MyBatis"><a href="#使用Java-API配置MyBatis" class="headerlink" title="使用Java API配置MyBatis"></a>使用Java API配置MyBatis</h2><p>上一节中，我们已经讨论了各种 MyBatis 配置元素，如 envronments,typeAlias,和 typeHandlers，以及如何使用XML 配置它们。即使你想使用基于 Java API 的 MyBatis 配置，经历上一节的学习是大有好处的，它可以帮你对这些配置元素有更好的理解。在本节中，我们会引用到前一节中描述的一些类。<br>MyBatis 的 SqlSessionFactory 接口除了使用基于 XML 的配置创建外也可以通过 Java API 编程式地被创建。每个在 XML 中配置的元素，都可以编程式的创建。使用 Java API 创建 SqlSessionFactory，代码如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public static SqlSessionFactory getSqlSessionFactory() &#123;</span><br><span class="line">		SqlSessionFactory sqlSessionFactory = null;</span><br><span class="line">		try &#123;</span><br><span class="line">			DataSource dataSource = DataSourceFactory.getDataSource();</span><br><span class="line">			TransactionFactory transactionFactory = new JdbcTransactionFactory();</span><br><span class="line">			Environment environment = new Environment("development", transactionFactory, dataSource);</span><br><span class="line">			Configuration configuration = new Configuration(environment);</span><br><span class="line">			configuration.getTypeAliasRegistry().registerAlias("student", Student.class);</span><br><span class="line">			configuration.getTypeHandlerRegistry().register(PhoneNumber.class, PhoneTypeHandler.class);</span><br><span class="line">			configuration.addMapper(StudentMapper.class);</span><br><span class="line">			sqlSessionFactory = new SqlSessionFactoryBuilder().build(configuration);</span><br><span class="line">		&#125; catch (Exception e) &#123;</span><br><span class="line">			throw new RuntimeException(e);</span><br><span class="line">		&#125;</span><br><span class="line">		return sqlSessionFactory;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="环境配置-Environment"><a href="#环境配置-Environment" class="headerlink" title="环境配置 Environment"></a>环境配置 Environment</h3><p>我们需要为想使用 MaBatis 连接的每一个数据库创建一个 Enviroment 对象。为了使用每一个环境，我们需要为每一个环境 environment 创建一个 SqlSessionFactory 对象。而创建 Environment 对象，我们需要 java.sql.DataSource和 TransactionFactory 实例。下面让我们看看如何创建 DataSource 和TransactionFactory 对象。</p>
<h3 id="数据源-DataSource-1"><a href="#数据源-DataSource-1" class="headerlink" title="数据源 DataSource"></a>数据源 DataSource</h3><p>MyBatis 支持三种内建的 DataSource 类型: UNPOOLED, POOLED, 和 JNDI.</p>
<ul>
<li>UNPOOLED 类型的数据源 dataSource 为每一个用户请求创建一个数据库连接。在多用户并发应用中，不建议<br>使用。</li>
<li>POOLED 类型的数据源 dataSource 创建了一个数据库连接池，对用户的每一个请求，会使用缓冲池中的一个<br>可 用 的 Connection 对 象 ， 这 样 可 以 提 高 应 用 的 性 能 。 MyBatis 提 供 了<br>org.apache.ibatis.datasource.pooled.PooledDataSource 实现 javax.sql.DataSource 来创建连<br>接池。</li>
<li>JNDI类型的数据源 dataSource使用了应用服务器的数据库连接池，并且使用 JNDI查找来获取数据库连接。</li>
</ul>
<p>让我们看一下怎样通过 MyBatis 的 PooledDataSource 获得 DataSource 对象，如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class DataSourceFactory &#123;</span><br><span class="line">		public static DataSource getDataSource() &#123;</span><br><span class="line">			String driver = "com.mysql.jdbc.Driver";</span><br><span class="line">			String url = "jdbc:mysql://localhost:3306/mybatisdemo";</span><br><span class="line">			String username = "root";</span><br><span class="line">			String password = "admin";</span><br><span class="line">			PooledDataSource dataSource = new PooledDataSource(driver, url, username, password);</span><br><span class="line">			return dataSource;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>一般在生产环境中，DataSource 会被应用服务器配置，并通过 JNDI 获取 DataSource 对象，如下所示：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class DataSourceFactory &#123;</span><br><span class="line">		public static DataSource getDataSource() &#123;</span><br><span class="line">			String jndiName = "java:comp/env/jdbc/MyBatisDemoDS";</span><br><span class="line">			try &#123;</span><br><span class="line">				InitialContext ctx = new InitialContext();</span><br><span class="line">				DataSource dataSource = (DataSource) ctx.lookup(jndiName);</span><br><span class="line">				return dataSource;</span><br><span class="line">			&#125; catch (NamingException e) &#123;</span><br><span class="line">				throw new RuntimeException(e);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>当前有一些流行的第三方类库，如 commons-dbcp 和 c3p0 实现了 java.sql.DataSource,你可以使用它们来创建<br>dataSource。</p>
<h3 id="事务工厂-TransactionFactory"><a href="#事务工厂-TransactionFactory" class="headerlink" title="事务工厂 TransactionFactory"></a>事务工厂 TransactionFactory</h3><p>MyBatis 支持一下两种 TransactionFactory 实现：</p>
<ul>
<li>JdbcTransactionFactory</li>
<li>ManagedTransactionFactory</li>
</ul>
<p>如果你的应用程序运行在未托管（non-managed）的环境中，你应该使用 JdbcTransactionFactory。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DataSource dataSource = DataSourceFactory.getDataSource();</span><br><span class="line">TransactionFactory txnFactory = new JdbcTransactionFactory();</span><br><span class="line">Environment environment = new Environment("development", txnFactory, dataSource);</span><br></pre></td></tr></table></figure></p>
<h3 id="类型别名-typeAliases-1"><a href="#类型别名-typeAliases-1" class="headerlink" title="类型别名 typeAliases"></a>类型别名 typeAliases</h3><p>MyBatis 提供以下几种通过 Configuration 对象注册类型别名的方法：</p>
<ol>
<li><p>根据默认的别名规则，使用一个类的首字母小写、非完全限定的类名作为别名注册，可使用以下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configuration.getTypeAliasRegistry().registerAlias(Student.class);</span><br></pre></td></tr></table></figure>
</li>
<li><p>指定指定别名注册，可使用以下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configuration.getTypeAliasRegistry().registerAlias(<span class="string">"Student"</span>,Student.class);</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过类的完全限定名注册相应类别名，可使用一下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configuration.getTypeAliasRegistry().registerAlias(<span class="string">"Student"</span>,<span class="string">"com.mybatis3.domain.Student"</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>为某一个包中的所有类注册别名，可使用以下代码：</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configuration.getTypeAliasRegistry().registerAliases(<span class="string">"com.mybatis3.domain"</span>);</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>为在 com.mybatis3.domain package 包中所有的继承自 Identifiable 类型的类注册别名，可使用以下代码：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configuration.getTypeAliasRegistry().registerAliases(<span class="string">"com.mybatis3.domain"</span>,Identifiable.class);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="类型处理器-typeHandlers-1"><a href="#类型处理器-typeHandlers-1" class="headerlink" title="类型处理器 typeHandlers"></a>类型处理器 typeHandlers</h3><p>MyBatis 提供了一系列使用 Configuration 对象注册类型处理器（type handler）的方法。我们可以通过以下方式注册自定义的类处理器：</p>
<ol>
<li><p>为某个特定的类注册类处理器:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configuration.getTypeHandlerRegistry().register(PhoneNumber.class, PhoneTypeHandler.class);</span><br></pre></td></tr></table></figure>
</li>
<li><p>注册一个类处理器:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configuration.getTypeHandlerRegistry().register(PhoneTypeHandler.class);</span><br></pre></td></tr></table></figure>
</li>
<li><p>注册 com.mybatis3.typehandlers 包中的所有类型处理器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configuration.getTypeHandlerRegistry().register(<span class="string">"com.mybatis3.typehandlers"</span>);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="全局参数设置-Settings-1"><a href="#全局参数设置-Settings-1" class="headerlink" title="全局参数设置 Settings"></a>全局参数设置 Settings</h3><p>MyBatis 提供了一组默认的，能够很好地适用大部分的应用的全局参数设置。然而，你可以稍微调整这些参数，让它更好地满足你应用的需要。你可以使用下列方法将全局参数设置成想要的值。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">configuration.setCacheEnabled(<span class="keyword">true</span>);</span><br><span class="line">configuration.setLazyLoadingEnabled(<span class="keyword">false</span>);</span><br><span class="line">configuration.setMultipleResultSetsEnabled(<span class="keyword">true</span>);</span><br><span class="line">configuration.setUseColumnLabel(<span class="keyword">true</span>);</span><br><span class="line">configuration.setUseGeneratedKeys(<span class="keyword">false</span>);</span><br><span class="line">configuration.setAutoMappingBehavior(AutoMappingBehavior.PARTIAL);</span><br><span class="line">configuration.setDefaultExecutorType(ExecutorType.SIMPLE);</span><br><span class="line">configuration.setDefaultStatementTimeout(<span class="number">25</span>);</span><br><span class="line">configuration.setSafeRowBoundsEnabled(<span class="keyword">false</span>);</span><br><span class="line">configuration.setMapUnderscoreToCamelCase(<span class="keyword">false</span>);</span><br><span class="line">configuration.setLocalCacheScope(LocalCacheScope.SESSION);</span><br><span class="line">configuration.setAggressiveLazyLoading(<span class="keyword">true</span>);</span><br><span class="line">configuration.setJdbcTypeForNull(JdbcType.OTHER);</span><br><span class="line">Set&lt;String&gt; lazyLoadTriggerMethods = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">lazyLoadTriggerMethods.add(<span class="string">"equals"</span>);</span><br><span class="line">lazyLoadTriggerMethods.add(<span class="string">"clone"</span>);</span><br><span class="line">lazyLoadTriggerMethods.add(<span class="string">"hashCode"</span>);</span><br><span class="line">lazyLoadTriggerMethods.add(<span class="string">"toString"</span>);</span><br><span class="line">configuration.setLazyLoadTriggerMethods(lazyLoadTriggerMethods );</span><br></pre></td></tr></table></figure></p>
<h3 id="Mappers"><a href="#Mappers" class="headerlink" title="Mappers"></a>Mappers</h3><p>MyBatis 提供了一些使用 Configuration 对象注册 Mapper XML 文件和 Mappe 接口的方法。</p>
<ol>
<li>添加一个 Mapper 接口，可使用以下代码:<br> configuration.addMapper(StudentMapper.class);</li>
<li>添加 com.mybatis3.mappers 包中的所有 Mapper XML 文件或者 Mapper 接口，可使用以下代码：<br> configuration.addMappers(“com.mybatis3.mappers”);</li>
<li>添加所有 com.mybatis3.mappers 包中的拓展了特定 Mapper 接口的 Maper 接口，如 aseMapper,可使用如下代码：<br> configuration.addMappers(“com.mybatis3.mappers”, BaseMapper.class);<br>Mappers 应该在 typeAliases 和 typeHandler 注册后再添加到 configuration 中。</li>
</ol>
<h2 id="自定义MyBatis日志"><a href="#自定义MyBatis日志" class="headerlink" title="自定义MyBatis日志"></a>自定义MyBatis日志</h2><p>MyBatis 使用其内部 LoggerFactory 作为真正的日志类库使用的门面。其内部的 LaggerFactory 会将日志记录任务委托给如下的所示某一个日志实现，日志记录优先级由上到下顺序递减：</p>
<ul>
<li>SLF4J</li>
<li>Apache Commons Logging</li>
<li>Log4j 2</li>
<li>Log4j</li>
<li>JDK logging4<br>如果 MyBatis 未发现上述日志记录实现，则 MyBatis 的日志记录功能无效。<br>如果你的运行环境中，在 classpath 中有多个可用的日志类库，并且你希望 MyBaits 使用某个特定的日志实现，你可<br>以通过调用以下其中一个方法：</li>
<li>org.apache.ibatis.logging.LogFactory.useSlf4jLogging();</li>
<li>org.apache.ibatis.logging.LogFactory.useLog4JLogging();</li>
<li>org.apache.ibatis.logging.LogFactory.useLog4J2Logging();</li>
<li>org.apache.ibatis.logging.LogFactory.useJdkLogging();</li>
<li>org.apache.ibatis.logging.LogFactory.useCommonsLogging();</li>
<li>org.apache.ibatis.logging.LogFactory.useStdOutLogging();</li>
</ul>
<p>如果你想自定义 MyBatis 日志记录，你应该在调用任何其它方法之前调用以上的其中一个方法。如果你想切换到的日志记录类库在运行时期无效，MyBatis 将会忽略这一请求。</p>
<h1 id="使用XMl配置SQL映射器"><a href="#使用XMl配置SQL映射器" class="headerlink" title="使用XMl配置SQL映射器"></a>使用XMl配置SQL映射器</h1><p>关系型数据库和 SQL 是经受时间考验和验证的数据存储机制。和其他的 ORM 框架如 Hibernate 不同，MyBatis 鼓励开发者可以直接使用数据库，而不是将其对开发者隐藏，因为这样可以充分发挥数据库服务器所提供的 SQL 语句的巨大威力。与此同时，MyBaits 消除了书写大量冗余代码的痛苦，它使使用 SQL 更容易。<br>在代码里直接嵌套 SQL 语句是很差的编码实践，并且维护起来困难。 MyBaits 使用了映射器配置文件或注解来配置 SQL语句。在本章中，我们会看到具体怎样使用映射器配置文件来配置映射 SQL 语句。<br>本章将涵盖以下话题：</p>
<ul>
<li>映射器配置文件 和 映射器接口</li>
<li>映射语句</li>
<li>配置 INSERT, UPDATE, DELETE, and SELECT 语句</li>
<li>结果映射 ResultMaps</li>
<li>简单 ResultMaps</li>
<li>使用内嵌 select 语句子查询的一对一映射</li>
<li>使用内嵌的结果集查询的一对一映射</li>
<li>使用内嵌 select 语句子查询的一对多映射</li>
<li>使用内嵌的结果集查询的一对一映射</li>
<li>动态 SQL 语句</li>
<li>If 条件</li>
<li>choose (when, otherwise) 条件</li>
<li>trim (where, set) 条件</li>
<li>foreach 循环</li>
<li>MyBatis 菜谱</li>
</ul>
<h2 id="映射器配置文件和映射器接口"><a href="#映射器配置文件和映射器接口" class="headerlink" title="映射器配置文件和映射器接口"></a>映射器配置文件和映射器接口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Student <span class="title">findStudentById</span><span class="params">(Integer studId)</span></span>&#123;</span><br><span class="line">	SqlSession sqlSession = MyBatisUtil.getSqlSession();</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		Student student =</span><br><span class="line">		sqlSession.selectOne(<span class="string">"com.mybatis3.mappers.StudentMapper.findStudentById"</span>, studId);</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">return</span> student;</span><br><span class="line">	&#125;<span class="keyword">finally</span></span><br><span class="line">	&#123;</span><br><span class="line">		sqlSession.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以通过字符串（字符串形式为：映射器配置文件所在的包名 namespace + 在文件内定义的语句 id，如上，即包名 com.mybatis3.mappers.StudentMapper 和语句 id findStudentById 组成）调用映射的 SQL 语句，但是这种方式容易出错。你需要检查映射器配置文件中的定义，以保证你的输入参数类型和结果返回类型是有效的。</p>
<p>MyBatis 通过使用映射器 Mapper 接口提供了更好的调用映射语句的方法。一旦我们通过映射器配置文件配置了映射语句，我们可以创建一个完全对应的一个映射器接口，接口名跟配置文件名相同，接口所在包名也跟配置文件所在包名完全一 样 ( 如 StudentMapper.xml 所 在 的 包 名 是 com.mybatis3.mappers ， 对 应 的 接 口 名 就 是<br>com.mybatis3.mappers.StudentMapper.java ）。映射器接口中的方法签名也跟映射器配置文件中完全对应：方法名为配置文件中 id 值；方法参数类型为 parameterType 对应值；方法返回值类型为 returnType 对应值。<br>对于上述的 StudentMapper.xml 文件，我们可以创建一个映射器接口 StudentMapper.java 如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mybatis3.mappers;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123;</span><br><span class="line">	<span class="function">Student <span class="title">findStudentById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在 StudentMapper.xml 映射器配置文件中，其名空间 namespace 应该跟 StudentMapper 接口的完全限定名保持一致。另外， StudentMapper.xml 中语句 id， parameterType， returnType 应该分别和 StudentMapper 接口中的方法名，参数类型，返回值相对应。使用映射器接口我们可以以类型安全的形式调用调用映射语句。如下所示：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Student <span class="title">findStudentById</span><span class="params">(Integer studId)</span></span>&#123;</span><br><span class="line">	SqlSession sqlSession = MyBatisUtil.getSqlSession();</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		StudentMapper studentMapper =sqlSession.getMapper(StudentMapper.class);</span><br><span class="line">		<span class="keyword">return</span> studentMapper.findStudentById(studId);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">finally</span></span><br><span class="line">	&#123;</span><br><span class="line">		sqlSession.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>即使映射器 Mapper 接口可以以类型安全的方式调用映射语句，但是我们我负责书写正确的，匹配方法名、参数类型、 和返回值的映射器 Mapper 接口。如果映射器 Mapper 接口中的方法和 XML 中的映射语句不能匹配，会在运行期抛出一个异常。实际上，指定 parameterType 是可选的；MyBatis 可以使用反射机制来决定 parameterType。 但是，从配置可读性的角度来看，最好指定parameterType 属性。如果 parameterType 没有被提及，开发者必须查看Mapper XML 配置和 Java 代码了解传递给语句的输入参数的数据类型。</p>
<h2 id="映射语句"><a href="#映射语句" class="headerlink" title="映射语句"></a>映射语句</h2><p>MyBatis 提供了多种元素来配置不同类型的语句，如 SELECT，INSERT，UPDATE，DELETE。接下来让我们看看如何具体配置映射语句</p>
<ol>
<li>Insert语句<br>一个 INSERT SQL 语句可以在<insert>元素在映射器 XML 配置文件中配置，如下所示：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertStudent"</span> <span class="attr">parameterType</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">	INSERT INTO STUDENTS(STUD_ID,NAME,EMAIL, PHONE)</span><br><span class="line">	VALUES(#&#123;studId&#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;phone&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
</insert></li>
</ol>
<p>这里我们使用一个 ID insertStudent，可以在名空间 com.mybatis3.mappers.StudentMapper.insertStudent 中唯一标识。 parameterType 属性应该是一个完全限定类名或者是一个类型别名（alias） 。我们可以如下调用这个语句：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> count = sqlSession.insert(<span class="string">"com.mybatis3.mappers.StudentMapper.insertStudent"</span>, student);</span><br></pre></td></tr></table></figure></p>
<p>sqlSession.insert() 方法返回执行 INSERT 语句后所影响的行数。<br>如果不使用名空间（namespace）和语句 id 来调用映射语句，你可以通过创建一个映射器 Mapper 接口，并以类型安全的方式调用方法，如下所示：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mybatis3.mappers;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">insertStudent</span><span class="params">(Student student)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>你可以如下调用 insertStudent 映射语句：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);</span><br><span class="line"><span class="keyword">int</span> count = mapper.insertStudent(student);</span><br></pre></td></tr></table></figure></p>
<p><strong>自动生成主键</strong><br>在上述的 INSERT 语句中，我们为可以自动生成（auto-generated）主键的列 STUD_ID 插入值。 我们可以使用<br>useGeneratedKeys 和 keyProperty 属性让数据库生成 auto_increment 列的值，并将生成的值设置到其中一个<br>输入对象属性内，如下所示：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertStudent"</span> <span class="attr">parameterType</span>=<span class="string">"Student"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">keyProperty</span>=<span class="string">"studId"</span>&gt;</span></span><br><span class="line">		INSERT INTO STUDENTS(NAME, EMAIL, PHONE)</span><br><span class="line">		VALUES(#&#123;name&#125;,#&#123;email&#125;,#&#123;phone&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这里 STUD_ID 列值将会被 MySQL 数据库自动生成，并且生成的值会被设置到 student 对象的 studId 属性上。</p>
<pre><code>StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);
mapper.insertStudent(student);
</code></pre><p>现在可以如下获取插入的 STUDENT 记录的 STUD_ID 的值：</p>
<pre><code>int studentId = student.getStudId();
</code></pre><p>有些数据库如 Oracle 并不支持 AUTO_INCREMENT 列，其使用序列（SEQUENCE）来生成主键值。<br>假设我们有一个名为 STUD_ID_SEQ 的序列来生成 SUTD_ID 主键值。使用如下代码来生成主键：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertStudent"</span> <span class="attr">parameterType</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">"studId"</span> <span class="attr">resultType</span>=<span class="string">"int"</span> <span class="attr">order</span>=<span class="string">"BEFORE"</span>&gt;</span></span><br><span class="line">		SELECT ELEARNING.STUD_ID_SEQ.NEXTVAL FROM DUAL</span><br><span class="line">	<span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">	INSERT INTO STUDENTS(STUD_ID,NAME,EMAIL, PHONE)</span><br><span class="line">	VALUES(#&#123;studId&#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;phone&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这里我们使用了<selectkey>子元素来生成主键值，并将值保存到 Student 对象的 studId 属性上。 属性<br>order=“before”表示 MyBatis 将取得序列的下一个值作为主键值，并且在执行 INSERT SQL 语句之前将值设置到<br>studId 属性上。</selectkey></p>
<p>我们也可以在获取序列的下一个值时，使用触发器（trigger）来设置主键值，并且在执行 INSERT SQL 语句之<br>前将值设置到主键列上。 如果你采取这样的方式，则对应的 INSERT 映射语句如下所示：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertStudent"</span> <span class="attr">parameterType</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">	INSERT INTO STUDENTS(NAME,EMAIL, PHONE)</span><br><span class="line">	VALUES(#&#123;name&#125;,#&#123;email&#125;,#&#123;phone&#125;)</span><br><span class="line">	<span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">"studId"</span> <span class="attr">resultType</span>=<span class="string">"int"</span> <span class="attr">order</span>=<span class="string">"AFTER"</span>&gt;</span></span><br><span class="line">		SELECT ELEARNING.STUD_ID_SEQ.CURRVAL FROM DUAL</span><br><span class="line">	<span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<ol start="2">
<li>UPDATE 语句<br>一个 UPDATE SQL 语句可以在<update>元素在映射器 XML 配置文件中配置，如下所示：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateStudent"</span> <span class="attr">parameterType</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">	UPDATE STUDENTS SET NAME=#&#123;name&#125;, EMAIL=#&#123;email&#125;, PHONE=#&#123;phone&#125;</span><br><span class="line">	WHERE STUD_ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
</update></li>
</ol>
<p>我们可以如下调用此语句：</p>
<pre><code>int noOfRowsUpdated = sqlSession.update(&quot;com.mybatis3.mappers.StudentMapper.updateStudent&quot;, student);
</code></pre><p>sqlSession.update() 方法返回执行 UPDATE 语句之后影响的行数。</p>
<p>如果不使用名空间（namespace）和语句 id 来调用映射语句，你可以通过创建一个映射器 Mapper 接口，并以类型<br>安全的方式调用方法，如下所示：</p>
<pre><code>package com.mybatis3.mappers;
public interface StudentMapper{
    int updateStudent(Student student);
}
</code></pre><p>你可以使用映射器 Mapper 接口来调用 updateStudent 语句，如下所示：</p>
<pre><code>StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);
int noOfRowsUpdated = mapper.updateStudent(student);
</code></pre><ol start="3">
<li>删除语句<br>一个 DELETE SQL 语句可以在<update>元素在映射器 XML 配置文件中配置，如下所示：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteStudent"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">	DELETE FROM STUDENTS WHERE STUD_ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>
</update></li>
</ol>
<p>我们可以如下调用此语句：</p>
<pre><code>int studId = 1;
int noOfRowsDeleted = sqlSession.delete(&quot;com.mybatis3.mappers.StudentMapper.deleteStudent&quot;, studId);
</code></pre><p>sqlSession.delete() 方法返回 delete 语句执行后影响的行数。</p>
<p>如果不使用名空间（namespace）和语句 id 来调用映射语句，你可以通过创建一个映射器 Mapper 接口，并以类型安全的方式调用方法，如下所示：</p>
<pre><code>package com.mybatis3.mappers;
public interface StudentMapper{
    int deleteStudent(int studId);
}
</code></pre><p>你可以使用映射器 Mapper 接口来调用 deleteStudent 语句，如下所示：</p>
<pre><code>StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);
int noOfRowsDeleted = mapper.deleteStudent(studId);
</code></pre><ol start="4">
<li>SELECT语句<br>MyBatis 真正强大的功能，在于映射 SELECT 查询结果到 JavaBeans 方面的极大灵活性。<br>让我们看看一个简单的 select 查询是如何（在 MyBatis 中）配置的，如下所示：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findStudentById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span></span></span><br><span class="line"><span class="tag"><span class="attr">resultType</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">	SELECT STUD_ID, NAME, EMAIL, PHONE</span><br><span class="line">	FROM STUDENTS</span><br><span class="line">	WHERE STUD_ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>我们可以如下调用此语句：</p>
<pre><code>int studId =1;
Student student = sqlSession.selectOne(&quot;com.mybatis3.mappers.StudentMapper.findStudentById&quot;, studId); 
</code></pre><p>如果不使用名空间（namespace）和语句 id 来调用映射语句，你可以通过创建一个映射器 Mapper 接口，并以类型安全的方式调用方法，如下所示：</p>
<pre><code>package com.mybatis3.mappers;
public interface StudentMapper{
    Student findStudentById(Integer studId);
}
</code></pre><p>你可以使用映射器 Mapper 接口来调用 updateStudent 语句，如下所示：</p>
<pre><code>StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);
Student student = mapper.findStudentById(studId);
</code></pre><p>如果你检查 Student 对象的属性值，你会发现 studId 属性值并没有被 stud_id 列值填充。这是因为 MyBatis 自动对JavaBean 中和列名匹配的属性进行填充。 这就是为什么 name ,email,和 phone 属性被填充，而 studId 属性没有被填充。<br>为了解决这一问题，我们可以为列名起一个可以与 JavaBean 中属性名匹配的别名，如下所示：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findStudentById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span></span></span><br><span class="line"><span class="tag"><span class="attr">resultType</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">	SELECT STUD_ID AS studId, NAME,EMAIL, PHONE</span><br><span class="line">	FROM STUDENTS</span><br><span class="line">	WHERE STUD_ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>现在，Student 这个 Bean 对象中的值将会恰当地被 stud_id,name,email,phone 列填充了。<br>现在，让我们看一下如何执行返回多条结果的 SELECT 语句查询，如下所示：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllStudents"</span> <span class="attr">resultType</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">	SELECT STUD_ID AS studId, NAME,EMAIL, PHONE</span><br><span class="line">	FROM STUDENTS</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<pre><code>List&lt;Student&gt; students = sqlSession.selectList(&quot;com.mybatis3.mappers.StudentMapper.findAllStudents&quot;);
</code></pre><p>映射器 Mapper 接口 StudentMapper 可以如下定义：</p>
<pre><code>package com.mybatis3.mappers;
public interface StudentMapper{
    List&lt;Student&gt; findAllStudents();
}
</code></pre><p>使用上述代码，我们可以如下调用 findAllStudents 语句：</p>
<pre><code>StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);
List&lt;Student&gt; students = mapper.findAllStudents();
</code></pre><p>如果你注意到上述的 SELECT 映射定义，你可以看到，我们为所有的映射语句中的 stud_id 起了别名。<br>我们可以使用 ResultMaps，来避免上述的到处重复别名。我们稍后会继续讨论。<br>除了 java.util.List，你也可以是由其他类型的集合类，如 Set,Map，以及（SortedSet） 。 MyBatis 根据集合的类型，会采用适当的集合实现，如下所示：</p>
<ul>
<li>对于 List，Collection，Iterable 类型，MyBatis 将返回 java.util.ArrayList</li>
<li>对于 Map 类型，MyBatis 将返回 java.util.HashMap</li>
<li>对于 Set 类型，MyBatis 将返回 java.util.HashSet</li>
<li>对于 SortedSet 类型，MyBatis 将返回 java.util.TreeSet</li>
</ul>
<h2 id="结果集映射-ResultMaps"><a href="#结果集映射-ResultMaps" class="headerlink" title="结果集映射 ResultMaps"></a>结果集映射 ResultMaps</h2><p>ResultMaps 被用来 将 SQL SELECT 语句的结果集映射到 JavaBeans的属性中。我们可以定义结果集映射 ResultMaps并且在一些 SELECT 语句上引用 resultMap。 MyBatis 的结果集映射 ResultMaps 特性非常强大，你可以使用它将简单的SELECT 语句映射到复杂的一对一和一对多关系的 SELECT 语句上。</p>
<h3 id="简单-ResultMap"><a href="#简单-ResultMap" class="headerlink" title="简单 ResultMap"></a>简单 ResultMap</h3><p>一个映射了查询结果和 Student JavaBean 的简单的 resultMap 定义如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"StudentResult"</span> <span class="attr">type</span>=<span class="string">"com.mybatis3.domain.Student"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"studId"</span> <span class="attr">column</span>=<span class="string">"stud_id"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"email"</span> <span class="attr">column</span>=<span class="string">"email"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"phone"</span> <span class="attr">column</span>=<span class="string">"phone"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllStudents"</span> <span class="attr">resultMap</span>=<span class="string">"StudentResult"</span>&gt;</span></span><br><span class="line">	SELECT * FROM STUDENTS</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findStudentById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultMap</span>=<span class="string">"StudentResult"</span>&gt;</span></span><br><span class="line">	SELECT * FROM STUDENTS WHERE STUD_ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>表示 resultMap 的 StudentResult id 值应该在此名空间内是唯一的。并且 type 属性应该是完全限定类名或者是返回类型的别名。<br><code>&lt;result&gt;</code>子元素被用来将一个 resultset 列映射到 JavaBean 的一个属性中。<br><code>&lt;id&gt;</code>元素和<code>&lt;result&gt;</code>元素功能相同，不过它被用来映射到唯一标识属性， 用来区分和比较对象 （一般和主键列相对应） 。<br>在<code>&lt;select&gt;</code>语句中，我们使用了 resultMap 属性，而不是 resultType 来引用 StudentResult 映射。 当<code>&lt;select&gt;</code>语句中配置了 resutlMap 属性，MyBatis 会使用此数据库列名与对象属性映射关系来填充 JavaBean 中的属性。<br>resultType 和 resultMap 二者只能用其一，不能同时使用。<br>让我们来看另外一个<code>&lt;select&gt;</code>映射语句定义的例子，怎样将查询结果填充到 HashMap 中。 如下所示：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findStudentById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">	SELECT * FROM STUDENTS WHERE STUD_ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在上述的<code>&lt;select&gt;</code>语句中，我们将 resultType 配置成 map，即 java.util.HashMap 的别名。在这种情况下，结果集的列名将会作为 Map 中的 key 值，而列值将作为 Map 的 value 值。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HashMap&lt;String,Object&gt; studentMap = sqlSession.selectOne(<span class="string">"com.</span></span><br><span class="line"><span class="string">mybatis3.mappers.StudentMapper.findStudentById"</span>, studId);</span><br><span class="line">System.out.println(<span class="string">"stud_id :"</span>+studentMap.get(<span class="string">"stud_id"</span>));</span><br><span class="line">System.out.println(<span class="string">"name :"</span>+studentMap.get(<span class="string">"name"</span>));</span><br><span class="line">System.out.println(<span class="string">"email :"</span>+studentMap.get(<span class="string">"email"</span>));</span><br><span class="line">System.out.println(<span class="string">"phone :"</span>+studentMap.get(<span class="string">"phone"</span>));</span><br></pre></td></tr></table></figure></p>
<p>让我们再看一个 使用 resultType=”map”,返回多行结果的例子：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllStudents"</span> <span class="attr">resultType</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">	SELECT STUD_ID, NAME, EMAIL, PHONE FROM STUDENTS</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>由于 resultType=”map”和语句返回多行，则最终返回的数据类型应该是 List&lt;HashMap&lt;String,Object&gt;&gt;，如下所示：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">List&lt;HashMap&lt;String, Object&gt;&gt; studentMapList =</span><br><span class="line">sqlSession.selectList(<span class="string">"com.mybatis3.mappers.StudentMapper.findAllStudents"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(HashMap&lt;String, Object&gt; studentMap : studentMapList)</span><br><span class="line">&#123;</span><br><span class="line">	System.out.println(<span class="string">"studId :"</span> + studentMap.get(<span class="string">"stud_id"</span>));</span><br><span class="line">	System.out.println(<span class="string">"name :"</span> + studentMap.get(<span class="string">"name"</span>));</span><br><span class="line">	System.out.println(<span class="string">"email :"</span> + studentMap.get(<span class="string">"email"</span>));</span><br><span class="line">	System.out.println(<span class="string">"phone :"</span> + studentMap.get(<span class="string">"phone"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="拓展-ResultMap"><a href="#拓展-ResultMap" class="headerlink" title="拓展 ResultMap"></a>拓展 ResultMap</h3><p>我们可以从从另外一个<resultmap>，拓展出一个新的<resultmap>，这样，原先的属性映射可以继承过来，以实现。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Student"</span> <span class="attr">id</span>=<span class="string">"StudentResult"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"studId"</span> <span class="attr">column</span>=<span class="string">"stud_id"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"email"</span> <span class="attr">column</span>=<span class="string">"email"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"phone"</span> <span class="attr">column</span>=<span class="string">"phone"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Student"</span> <span class="attr">id</span>=<span class="string">"StudentWithAddressResult"</span> <span class="attr">extends</span>=<span class="string">"StudentResult"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address.addrId"</span> <span class="attr">column</span>=<span class="string">"addr_id"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address.street"</span> <span class="attr">column</span>=<span class="string">"street"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address.city"</span> <span class="attr">column</span>=<span class="string">"city"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address.state"</span> <span class="attr">column</span>=<span class="string">"state"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address.zip"</span> <span class="attr">column</span>=<span class="string">"zip"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address.country"</span> <span class="attr">column</span>=<span class="string">"country"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure></resultmap></resultmap></p>
<p>id 为 StudentWithAddressResult 的 resultMap 拓展了 id 为 StudentResult 的 resultMap。<br>如果你只想映射 Student 数据，你可以使用 id 为 StudentResult 的 resultMap,如下所示：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findStudentById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span></span></span><br><span class="line"><span class="tag"><span class="attr">resultMap</span>=<span class="string">"StudentResult"</span>&gt;</span></span><br><span class="line">	SELECT * FROM STUDENTS WHERE STUD_ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>如果你想将映射 Student 数据和 Address 数据，你可以使用 id 为 StudentWithAddressResult 的resultMap：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectStudentWithAddress"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span></span></span><br><span class="line"><span class="tag"><span class="attr">resultMap</span>=<span class="string">"StudentWithAddressResult"</span>&gt;</span></span><br><span class="line">	SELECT STUD_ID, NAME, EMAIL, PHONE, A.ADDR_ID, STREET, CITY,</span><br><span class="line">	STATE, ZIP, COUNTRY</span><br><span class="line">	FROM STUDENTS S LEFT OUTER JOIN ADDRESSES A ON</span><br><span class="line">	S.ADDR_ID=A.ADDR_ID</span><br><span class="line">	WHERE STUD_ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="一对一映射"><a href="#一对一映射" class="headerlink" title="一对一映射"></a>一对一映射</h2><p>在我们的域模型样例中，每一个学生都有一个与之关联的地址信息。 表 STUDENTS 有一个 ADDR_ID 列，是 ADDRESSES表的外键。<br>STUDENTS 表的样例数据如下所示：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">STUD_ID	NAME 	EMAIL	 	PHONE	 	ADDR_ID</span><br><span class="line"><span class="number">1</span> 	John	john<span class="meta">@gmail</span>.com	 <span class="number">123</span>-<span class="number">456</span>-<span class="number">7890</span> 	<span class="number">1</span></span><br><span class="line"><span class="number">2</span> 	Paul	paul<span class="meta">@gmail</span>.com	 <span class="number">111</span>-<span class="number">222</span>-<span class="number">3333</span> 	<span class="number">2</span></span><br></pre></td></tr></table></figure></p>
<p>ADDRESSES 表的样例输入如下所示：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ADDR_ID	 STREET	 	CITY	 STATE	 ZIP 	COUNTRY</span><br><span class="line"><span class="number">1</span> 	Naperville	 CHICAGO	 IL	 <span class="number">60515</span>		USA</span><br><span class="line"><span class="number">2</span> 	Paul		 CHICAGO	 IL	 <span class="number">60515</span>		USA</span><br></pre></td></tr></table></figure></p>
<p>下面让我们看一下怎样取 Student 明细和其 Address 明细。<br>Student 和 Address 的 JavaBean 以及映射器 Mapper XML 文件定义如下所示：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer addrId;</span><br><span class="line">	<span class="keyword">private</span> String street;</span><br><span class="line">	<span class="keyword">private</span> String city;</span><br><span class="line">	<span class="keyword">private</span> String state;</span><br><span class="line">	<span class="keyword">private</span> String zip;</span><br><span class="line">	<span class="keyword">private</span> String country;</span><br><span class="line">	<span class="comment">// setters &amp; getters</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer studId;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String email;</span><br><span class="line">	<span class="keyword">private</span> PhoneNumber phone;</span><br><span class="line">	<span class="keyword">private</span> Address address;</span><br><span class="line">	<span class="comment">//setters &amp; getters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Student"</span> <span class="attr">id</span>=<span class="string">"StudentWithAddressResult"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"studId"</span> <span class="attr">column</span>=<span class="string">"stud_id"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"email"</span> <span class="attr">column</span>=<span class="string">"email"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"phone"</span> <span class="attr">column</span>=<span class="string">"phone"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address.addrId"</span> <span class="attr">column</span>=<span class="string">"addr_id"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address.street"</span> <span class="attr">column</span>=<span class="string">"street"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address.city"</span> <span class="attr">column</span>=<span class="string">"city"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address.state"</span> <span class="attr">column</span>=<span class="string">"state"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address.zip"</span> <span class="attr">column</span>=<span class="string">"zip"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address.country"</span> <span class="attr">column</span>=<span class="string">"country"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectStudentWithAddress"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">resultMap</span>=<span class="string">"StudentWithAddressResult"</span>&gt;</span></span><br><span class="line">		SELECT STUD_ID, NAME, EMAIL, A.ADDR_ID, STREET, CITY, STATE,</span><br><span class="line">			ZIP, COUNTRY</span><br><span class="line">		FROM STUDENTS S LEFT OUTER JOIN ADDRESSES A ON</span><br><span class="line">			S.ADDR_ID=A.ADDR_ID</span><br><span class="line">		WHERE STUD_ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们可以使用圆点记法为内嵌的对象的属性赋值。 在上述的 resultMap 中，Student 的 address 属性使用了圆点记法被赋上了 address 对应列的值。同样地，我们可以访问任意深度的内嵌对象的属性。 我们可以如下访问内嵌对象属性：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//接口定义</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123;</span><br><span class="line">	<span class="function">Student <span class="title">selectStudentWithAddress</span><span class="params">(<span class="keyword">int</span> studId)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//使用</span></span><br><span class="line"><span class="keyword">int</span> studId = <span class="number">1</span>;</span><br><span class="line">StudentMapper studentMapper = sqlSession.getMapper(StudentMapper.class);</span><br><span class="line">Student student = studentMapper.selectStudentWithAddress(studId);</span><br><span class="line">System.out.println(<span class="string">"Student :"</span> + student);</span><br><span class="line">System.out.println(<span class="string">"Address :"</span> + student.getAddress());</span><br></pre></td></tr></table></figure></p>
<p>上述样例展示了一对一关联映射的一种方法。然而，使用这种方式映射，如果 address 结果需要在其他的 SELECT 映射语句中映射成 Address 对象，我们需要为每一个语句重复这种映射关系。 MyBatis 提供了更好地实现一对一关联映射的方法：嵌套结果 ResultMap 和嵌套 select 查询语句。接下来，我们将讨论这两种方式。</p>
<h3 id="使用嵌套结果-ResultMap-实现一对一关系映射"><a href="#使用嵌套结果-ResultMap-实现一对一关系映射" class="headerlink" title="使用嵌套结果 ResultMap 实现一对一关系映射"></a>使用嵌套结果 ResultMap 实现一对一关系映射</h3><p>我们可以使用一个嵌套结果 ResultMap 方式来获取 Student 及其 Address 信息，代码如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Address"</span> <span class="attr">id</span>=<span class="string">"AddressResult"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"addrId"</span> <span class="attr">column</span>=<span class="string">"addr_id"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"street"</span> <span class="attr">column</span>=<span class="string">"street"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"city"</span> <span class="attr">column</span>=<span class="string">"city"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"state"</span> <span class="attr">column</span>=<span class="string">"state"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"zip"</span> <span class="attr">column</span>=<span class="string">"zip"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"country"</span> <span class="attr">column</span>=<span class="string">"country"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Student"</span> <span class="attr">id</span>=<span class="string">"StudentWithAddressResult"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"studId"</span> <span class="attr">column</span>=<span class="string">"stud_id"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"email"</span> <span class="attr">column</span>=<span class="string">"email"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">resultMap</span>=<span class="string">"AddressResult"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findStudentWithAddress"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span></span></span><br><span class="line"><span class="tag"><span class="attr">resultMap</span>=<span class="string">"StudentWithAddressResult"</span>&gt;</span></span><br><span class="line">	SELECT STUD_ID, NAME, EMAIL, A.ADDR_ID, STREET, CITY, STATE,</span><br><span class="line">	ZIP, COUNTRY</span><br><span class="line">	FROM STUDENTS S LEFT OUTER JOIN ADDRESSES A ON</span><br><span class="line">	S.ADDR_ID=A.ADDR_ID</span><br><span class="line">	WHERE STUD_ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>元素<association>被用来导入“有一个”(has-one)类型的关联。 在上述的例子中，我们使用了<association>元素<br>引用了另外的在同一个 XML 文件中定义的<resultmap>。</resultmap></association></association></p>
<p>我们也可以使用<association>定义内联的 resultMap，代码如下所示：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Student"</span> <span class="attr">id</span>=<span class="string">"StudentWithAddressResult"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"studId"</span> <span class="attr">column</span>=<span class="string">"stud_id"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"email"</span> <span class="attr">column</span>=<span class="string">"email"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">javaType</span>=<span class="string">"Address"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"addrId"</span> <span class="attr">column</span>=<span class="string">"addr_id"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"street"</span> <span class="attr">column</span>=<span class="string">"street"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"city"</span> <span class="attr">column</span>=<span class="string">"city"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"state"</span> <span class="attr">column</span>=<span class="string">"state"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"zip"</span> <span class="attr">column</span>=<span class="string">"zip"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"country"</span> <span class="attr">column</span>=<span class="string">"country"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure></association></p>
<p>使用嵌套结果 ResultMap 方式，关联的数据可以通过简单的查询语句（如果需要的话，需要与 joins 连接操作配合）进行加载。</p>
<h3 id="使用嵌套查询实现一对一关系映射"><a href="#使用嵌套查询实现一对一关系映射" class="headerlink" title="使用嵌套查询实现一对一关系映射"></a>使用嵌套查询实现一对一关系映射</h3><p>我们可以通过使用嵌套 select 查询来获取 Student 及其 Address 信息，代码如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Address"</span> <span class="attr">id</span>=<span class="string">"AddressResult"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"addrId"</span> <span class="attr">column</span>=<span class="string">"addr_id"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"street"</span> <span class="attr">column</span>=<span class="string">"street"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"city"</span> <span class="attr">column</span>=<span class="string">"city"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"state"</span> <span class="attr">column</span>=<span class="string">"state"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"zip"</span> <span class="attr">column</span>=<span class="string">"zip"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"country"</span> <span class="attr">column</span>=<span class="string">"country"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAddressById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span></span></span><br><span class="line"><span class="tag"><span class="attr">resultMap</span>=<span class="string">"AddressResult"</span>&gt;</span></span><br><span class="line">	SELECT * FROM ADDRESSES WHERE ADDR_ID=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Student"</span> <span class="attr">id</span>=<span class="string">"StudentWithAddressResult"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"studId"</span> <span class="attr">column</span>=<span class="string">"stud_id"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"email"</span> <span class="attr">column</span>=<span class="string">"email"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"addr_id"</span> <span class="attr">select</span>=<span class="string">"findAddressById"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findStudentWithAddress"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span></span></span><br><span class="line"><span class="tag"><span class="attr">resultMap</span>=<span class="string">"StudentWithAddressResult"</span>&gt;</span></span><br><span class="line">	SELECT * FROM STUDENTS WHERE STUD_ID=#&#123;Id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在此方式中，<association>元素的 select 属性被设置成了 id 为 findAddressById 的语句。这里，两个分开的SQL 语句将会在数据库中执行，第一个调用 findStudentById 加载 student 信息，而第二个调用 findAddressById 来加载 address 信息。<br>Addr_id 列的值将会被作为输入参数传递给 selectAddressById 语句。<br>我们可以如下调用 findStudentWithAddress 映射语句：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);</span><br><span class="line">Student student = mapper.selectStudentWithAddress(studId);</span><br><span class="line">System.out.println(student);</span><br><span class="line">System.out.println(student.getAddress());</span><br></pre></td></tr></table></figure></association></p>
<h2 id="一对多映射"><a href="#一对多映射" class="headerlink" title="一对多映射"></a>一对多映射</h2><p>在我们的域模型样例中，一个讲师可以教授一个或者多个课程。 这意味着讲师和课程之间存在一对多的映射关系。<br>我们可以使用<collection>元素将 一对多类型的结果 映射到 一个对象集合上。<br>TUTORS 表的样例数据如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TUTOR_ID	 NAME EMAIL 		PHONE ADDR_ID</span><br><span class="line"><span class="number">1</span> 		John john<span class="meta">@gmail</span>.com 	<span class="number">123</span>-<span class="number">456</span>-<span class="number">7890</span> <span class="number">1</span></span><br><span class="line"><span class="number">2</span>	 	Ying ying<span class="meta">@gmail</span>.com 	<span class="number">111</span>-<span class="number">222</span>-<span class="number">3333</span> <span class="number">2</span></span><br></pre></td></tr></table></figure></collection></p>
<p>COURSE 表的样例数据如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">COURSE_ID	 NAME	 	DESCRIPTION	 	START_DATE	 END_DATE 	TUTOR_ID</span><br><span class="line"><span class="number">1</span> 		JavaSE 		Java SE 		<span class="number">2013</span>-<span class="number">01</span>-<span class="number">10</span>	 <span class="number">2013</span>-<span class="number">02</span>-<span class="number">10</span>		<span class="number">1</span></span><br><span class="line"><span class="number">2</span> 		JavaEE 		Java EE <span class="number">6</span> 		<span class="number">2013</span>-<span class="number">01</span>-<span class="number">10</span> 	 <span class="number">2013</span>-<span class="number">03</span>-<span class="number">10</span>		<span class="number">2</span></span><br><span class="line"><span class="number">3</span> 		MyBatis 	MyBatis 		<span class="number">2013</span>-<span class="number">01</span>-<span class="number">10</span> 	 <span class="number">2013</span>-<span class="number">02</span>-<span class="number">20</span>		<span class="number">2</span></span><br></pre></td></tr></table></figure></p>
<p>在上述的表数据中，John 讲师教授一个课程，而 Ying 讲师教授两个课程。<br>Course 和 Tutor 的 JavaBean 定义如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Course</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer courseId;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String description;</span><br><span class="line">	<span class="keyword">private</span> Date startDate;</span><br><span class="line">	<span class="keyword">private</span> Date endDate;</span><br><span class="line">	<span class="keyword">private</span> Integer tutorId;</span><br><span class="line">	<span class="comment">//setters &amp; getters</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tutor</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer tutorId;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String email;</span><br><span class="line">	<span class="keyword">private</span> Address address;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Course&gt; courses;</span><br><span class="line">	/ setters &amp; getters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>现在让我们看看如何获取讲师信息以及其所教授的课程列表信息。<br><code>&lt;collection&gt;</code>元素被用来将多行课程结果映射成一个课程 Course 对象的一个集合。 和一对一映射一样，我们可以使用嵌套结果 ResultMap 和嵌套 Select 语句两种方式映射实现一对多映射。</p>
<h3 id="使用内嵌结果-ResultMap-实现一对多映射"><a href="#使用内嵌结果-ResultMap-实现一对多映射" class="headerlink" title="使用内嵌结果 ResultMap 实现一对多映射"></a>使用内嵌结果 ResultMap 实现一对多映射</h3><p>我们可以使用嵌套结果 resultMap 方式获得讲师及其课程信息，代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Course"</span> <span class="attr">id</span>=<span class="string">"CourseResult"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"course_id"</span> <span class="attr">property</span>=<span class="string">"courseId"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"description"</span> <span class="attr">property</span>=<span class="string">"description"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"start_date"</span> <span class="attr">property</span>=<span class="string">"startDate"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"end_date"</span> <span class="attr">property</span>=<span class="string">"endDate"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Tutor"</span> <span class="attr">id</span>=<span class="string">"TutorResult"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"tutor_id"</span> <span class="attr">property</span>=<span class="string">"tutorId"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"tutor_name"</span> <span class="attr">property</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"email"</span> <span class="attr">property</span>=<span class="string">"email"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"courses"</span> <span class="attr">resultMap</span>=<span class="string">"CourseResult"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findTutorById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultMap</span>=<span class="string">"TutorResult"</span>&gt;</span></span><br><span class="line">	SELECT T.TUTOR_ID, T.NAME AS TUTOR_NAME, EMAIL, C.COURSE_ID,</span><br><span class="line">		C.NAME, DESCRIPTION, START_DATE, END_DATE</span><br><span class="line">	FROM TUTORS T LEFT OUTER JOIN ADDRESSES A ON T.ADDR_ID=A.ADDR_ID</span><br><span class="line">		LEFT OUTER JOIN COURSES C ON T.TUTOR_ID=C.TUTOR_ID</span><br><span class="line">	WHERE T.TUTOR_ID=#&#123;tutorId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里我们使用了一个简单的使用了 JOINS 连接的 Select 语句获取讲师及其所教课程信息。 <collection>元素的resultMap 属性设置成了 CourseResult，CourseResult 包含了 Course 对象属性与表列名之间的映射。</collection></p>
<h3 id="使用嵌套-Select-语句实现一对多映射"><a href="#使用嵌套-Select-语句实现一对多映射" class="headerlink" title="使用嵌套 Select 语句实现一对多映射"></a>使用嵌套 Select 语句实现一对多映射</h3><p>我们可以使用嵌套 Select 语句方式获得讲师及其课程信息，代码如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Course"</span> <span class="attr">id</span>=<span class="string">"CourseResult"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"course_id"</span> <span class="attr">property</span>=<span class="string">"courseId"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"description"</span> <span class="attr">property</span>=<span class="string">"description"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"start_date"</span> <span class="attr">property</span>=<span class="string">"startDate"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"end_date"</span> <span class="attr">property</span>=<span class="string">"endDate"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Tutor"</span> <span class="attr">id</span>=<span class="string">"TutorResult"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"tutor_id"</span> <span class="attr">property</span>=<span class="string">"tutorId"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"tutor_name"</span> <span class="attr">property</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"email"</span> <span class="attr">property</span>=<span class="string">"email"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">resultMap</span>=<span class="string">"AddressResult"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"courses"</span> <span class="attr">column</span>=<span class="string">"tutor_id"</span> <span class="attr">select</span>=<span class="string">"findCoursesByTutor"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findTutorById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultMap</span>=<span class="string">"TutorResult"</span>&gt;</span></span><br><span class="line">	SELECT T.TUTOR_ID, T.NAME AS TUTOR_NAME, EMAIL</span><br><span class="line">	FROM TUTORS T WHERE T.TUTOR_ID=#&#123;tutorId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findCoursesByTutor"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultMap</span>=<span class="string">"CourseResult"</span>&gt;</span></span><br><span class="line">	SELECT * FROM COURSES WHERE TUTOR_ID=#&#123;tutorId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在这种方式中，<aossication>元素的 select 属性被设置为 id 为 findCourseByTutor 的语句，用来触发单独的 SQL 查询加载课程信息。 tutor_id 这一列值将会作为输入参数传递给 findCouresByTutor 语句。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TutorMapper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="function">Tutor <span class="title">findTutorById</span><span class="params">(<span class="keyword">int</span> tutorId)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">	TutorMapper mapper = sqlSession.getMapper(TutorMapper.class);</span><br><span class="line">	Tutor tutor = mapper.findTutorById(tutorId);</span><br><span class="line">	System.out.println(tutor);</span><br><span class="line">	List&lt;Course&gt; courses = tutor.getCourses();</span><br><span class="line">	<span class="keyword">for</span> (Course course : courses)</span><br><span class="line">	&#123;</span><br><span class="line">		System.out.println(course);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></aossication></p>
<blockquote>
<p>嵌套 Select 语句查询会导致 N+1 选择问题。 首先，主查询将会执行（1 次） ，对于主<br>查询返回的每一行，另外一个查询将会被执行（主查询 N 行，则此查询 N 次） 。 对于<br>大型数据库而言，这会导致很差的性能问题。</p>
</blockquote>
<h2 id="动态-SQL"><a href="#动态-SQL" class="headerlink" title="动态 SQL"></a>动态 SQL</h2><p>有时候，静态的 SQL 语句并不能满足应用程序的需求。我们可以根据一些条件，来动态地构建 SQL 语句。<br>例如，在 Web 应用程序中，有可能有一些搜索界面，需要输入一个或多个选项，然后根据这些已选择的条件去执行检索操作。在实现这种类型的搜索功能，我们可能需要根据这些条件 来构建动态的 SQL 语句。 如果用户提供了任何输入条件，我们需要将那个条件 添加到 SQL 语句的 WHERE 子句中。<br>MyBatis 通过使用<if>,<choose>,<where>,<foreach>,<trim>元素提供了对构造动态 SQL 语句的高级别支持。</trim></foreach></where></choose></if></p>
<h3 id="IF条件"><a href="#IF条件" class="headerlink" title="IF条件"></a>IF条件</h3><p><if>元素被用来有条件地嵌入 SQL 片段，如果测试条件被赋值为 true，则相应地 SQL 片段将会被添加到 SQL 语句中。<br>假定我们有一个课程搜索界面，设置了 讲师（Tutor）下拉列表框，课程名称（CourseName）文本输入框，开始<br>时间（StartDate）输入框，结束时间（EndDate）输入框，作为搜索条件。假定课讲师下拉列表是必须选的，其他的都是可选的。</if></p>
<p>当用户点击 搜索 按钮时，我们需要显示符合以下条件的成列表：</p>
<ul>
<li>特定讲师的课程</li>
<li>课程名 包含输入的课程名称关键字的课程；如果课程名称输入为空，则取所有课程</li>
<li>在开始时间和结束时间段内的课程<br>我们可以对应的映射语句，如下所示：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Course"</span> <span class="attr">id</span>=<span class="string">"CourseResult"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"course_id"</span> <span class="attr">property</span>=<span class="string">"courseId"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"description"</span> <span class="attr">property</span>=<span class="string">"description"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"start_date"</span> <span class="attr">property</span>=<span class="string">"startDate"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"end_date"</span> <span class="attr">property</span>=<span class="string">"endDate"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"searchCourses"</span> <span class="attr">parameterType</span>=<span class="string">"hashmap"</span> <span class="attr">resultMap</span>=<span class="string">"CourseResult"</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">SELECT * FROM COURSES</span><br><span class="line">WHERE TUTOR_ID= #&#123;tutorId&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"courseName != null"</span>&gt;</span></span><br><span class="line">	AND NAME LIKE #&#123;courseName&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"startDate != null"</span>&gt;</span></span><br><span class="line">	AND START_DATE &gt;= #&#123;startDate&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"endDate != null"</span>&gt;</span></span><br><span class="line">	AND END_DATE <span class="tag">&lt;<span class="name">=</span> #&#123;<span class="attr">endDate</span>&#125;</span></span><br><span class="line">&lt;/if&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CourseMapper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="function">List&lt;Course&gt; <span class="title">searchCourses</span><span class="params">(Map&lt;String, Object&gt; map)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">searchCourses</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">	map.put(<span class="string">"tutorId"</span>, <span class="number">1</span>);</span><br><span class="line">	map.put(<span class="string">"courseName"</span>, <span class="string">"%java%"</span>);</span><br><span class="line">	map.put(<span class="string">"startDate"</span>, <span class="keyword">new</span> Date());</span><br><span class="line">	CourseMapper mapper = sqlSession.getMapper(CourseMapper.class);</span><br><span class="line">	List&lt;Course&gt; courses = mapper.searchCourses(map);</span><br><span class="line">	<span class="keyword">for</span> (Course course : courses)</span><br><span class="line">	&#123;</span><br><span class="line">		System.out.println(course);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此处将生成查询语句 SELECT * FROM COURSES WHERE TUTOR_ID= ? AND NAME like ? AND START_DATE &gt;= ?。准备根据给定条件的动态 SQL 查询将会派上用场。</p>
<blockquote>
<p>MyBatis 是使用 ONGL（Object Graph Navigation Language）表达式来构建动态 SQL 语句。</p>
</blockquote>
<h3 id="choose-when-和-otherwise-条件"><a href="#choose-when-和-otherwise-条件" class="headerlink" title="choose,when 和 otherwise 条件"></a>choose,when 和 otherwise 条件</h3><p>有时候，查询功能是以查询类别为基础的。 首先，用户需要选择是否希望通过选择 讲师，课程名称，开始时间，<br>或结束时间作为查询条件类别来进行查询，然后根据选择的查询类别，输入相应的参数。在这样的情景中，我们需要只使用其中一种查询类别。<br>MyBatis 提供了<code>&lt;choose&gt;</code>元素支持此类型的 SQL 预处理。<br>现在让我们书写一个适用此情景的 SQL 映射语句。如果没有选择查询类别，则查询开始时间在今天之后的课程，<br>代码如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"searchCourses"</span> <span class="attr">parameterType</span>=<span class="string">"hashmap"</span> <span class="attr">resultMap</span>=<span class="string">"CourseResult"</span>&gt;</span></span><br><span class="line">	SELECT * FROM COURSES</span><br><span class="line">	<span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"searchBy == 'Tutor'"</span>&gt;</span></span><br><span class="line">			WHERE TUTOR_ID= #&#123;tutorId&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"searchBy == 'CourseName'"</span>&gt;</span></span><br><span class="line">			WHERE name like #&#123;courseName&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">			WHERE TUTOR start_date &gt;= now()</span><br><span class="line">		<span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>MyBatis 计算<choose>测试条件的值， 且使用第一个值为 TRUE 的子句。如果没有条件为 true， 则使用<code>&lt;otherwise&gt;</code>内的子句。</choose></p>
<h3 id="Where-条件"><a href="#Where-条件" class="headerlink" title="Where 条件"></a>Where 条件</h3><p>有时候，所有的查询条件 （criteria）应该是可选的。 在需要使用至少一种查询条件的情况下， 我们应该使用 WHERE子句。并且， 如果有多个条件，我们需要在条件中添加 AND 或 OR。 MyBatis 提供了<code>&lt;where&gt;</code>元素支持这种类型的动态 SQL 语句。<br>在我们查询课程界面，我们假设所有的查询条件是可选的。 进而，当需要提供一个或多个查询条件时，应该改使用<br>WHERE 子句。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"searchCourses"</span> <span class="attr">parameterType</span>=<span class="string">"hashmap"</span> <span class="attr">resultMap</span>=<span class="string">"CourseResult"</span>&gt;</span></span><br><span class="line">	SELECT * FROM COURSES</span><br><span class="line">	<span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">" tutorId != null "</span>&gt;</span></span><br><span class="line">			TUTOR_ID= #&#123;tutorId&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"courseName != null"</span>&gt;</span></span><br><span class="line">			AND name like #&#123;courseName&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"startDate != null"</span>&gt;</span></span><br><span class="line">			AND start_date &gt;= #&#123;startDate&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"endDate != null"</span>&gt;</span></span><br><span class="line">			AND end_date <span class="tag">&lt;<span class="name">=</span> #&#123;<span class="attr">endDate</span>&#125;</span></span><br><span class="line">		&lt;/if&gt;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;where&gt;</code>元素只有在其内部标签有返回内容时才会在动态语句上插入 WHERE 条件语句。 并且，如果 WHERE 子句以AND 或者 OR 打头，则打头的 AND 或 OR 将会被移除。<br>如果 tutor_id 参数值为 null，并且 courseName 参数值不为 null，则<code>&lt;where&gt;</code>标签会将 </p>
<blockquote>
<p>AND name like #{courseName} 中的 AND 移除掉，生成的 SQL WHERE 子句为：where name like #{courseName}。</p>
</blockquote>
<h3 id="条件"><a href="#条件" class="headerlink" title="条件"></a><trim>条件</trim></h3><p><code>&lt;trim&gt;</code>元素和<code>&lt;where&gt;</code>元素类似，但是<code>&lt;trim&gt;</code>提供了在添加前缀/后缀 或者 移除前缀/后缀方面提供更大的灵活性。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"searchCourses"</span> <span class="attr">parameterType</span>=<span class="string">"hashmap"</span> <span class="attr">resultMap</span>=<span class="string">"CourseResult"</span>&gt;</span></span><br><span class="line">	SELECT * FROM COURSES</span><br><span class="line">	<span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"WHERE"</span> <span class="attr">prefixOverrides</span>=<span class="string">"AND | OR"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">" tutorId != null "</span>&gt;</span></span><br><span class="line">			TUTOR_ID= #&#123;tutorId&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"courseName != null"</span>&gt;</span></span><br><span class="line">			AND name like #&#123;courseName&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里如果任意一个<code>&lt;if&gt;</code>条件为 true，<code>&lt;trim&gt;</code>元素会插入 WHERE,并且移除紧跟 WHERE 后面的 AND 或 OR</p>
<h3 id="foreach-循环"><a href="#foreach-循环" class="headerlink" title="foreach 循环"></a>foreach 循环</h3><p>另外一个强大的动态 SQL 语句构造标签即是<foreach>。它可以迭代遍历一个数组或者列表，构造 AND/OR 条件或一个 IN 子句。<br>假设我们想找到 tutor_id 为 1，3，6 的讲师所教授的课程，我们可以传递一个 tutor_id 组成的列表给映射语句，然后通过<foreach>遍历此列表构造动态 SQL。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"searchCoursesByTutors"</span> <span class="attr">parameterType</span>=<span class="string">"map"</span> <span class="attr">resultMap</span>=<span class="string">"CourseResult"</span>&gt;</span></span><br><span class="line">	SELECT * FROM COURSES</span><br><span class="line">	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"tutorIds != null"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">"tutorId"</span> <span class="attr">collection</span>=<span class="string">"tutorIds"</span>&gt;</span></span><br><span class="line">				OR tutor_id=#&#123;tutorId&#125;</span><br><span class="line">			<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></foreach></foreach></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CourseMapper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="function">List&lt;Course&gt; <span class="title">searchCoursesByTutors</span><span class="params">(Map&lt;String, Object&gt; map)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">searchCoursesByTutors</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">	List&lt;Integer&gt; tutorIds = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">	tutorIds.add(<span class="number">1</span>);</span><br><span class="line">	tutorIds.add(<span class="number">3</span>);</span><br><span class="line">	tutorIds.add(<span class="number">6</span>);</span><br><span class="line">	map.put(<span class="string">"tutorIds"</span>, tutorIds);</span><br><span class="line">	CourseMapper mapper = sqlSession.getMapper(CourseMapper.class);</span><br><span class="line">	List&lt;Course&gt; courses = mapper.searchCoursesByTutors(map);</span><br><span class="line">	<span class="keyword">for</span> (Course course : courses)</span><br><span class="line">	&#123;</span><br><span class="line">		System.out.println(course);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在让我们来看一下怎样使用<code>&lt;foreach&gt;</code>生成 IN 子句：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"searchCoursesByTutors"</span> <span class="attr">parameterType</span>=<span class="string">"map"</span> <span class="attr">resultMap</span>=<span class="string">"CourseResult"</span>&gt;</span></span><br><span class="line">	SELECT * FROM COURSES</span><br><span class="line">	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"tutorIds != null"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">			tutor_id IN</span><br><span class="line">			<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">"tutorId"</span> <span class="attr">collection</span>=<span class="string">"tutorIds"</span> <span class="attr">open</span>=<span class="string">"("</span></span></span><br><span class="line"><span class="tag">				<span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">				#&#123;tutorId&#125;</span><br><span class="line">			<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="set条件"><a href="#set条件" class="headerlink" title="set条件"></a>set条件</h3><p><code>&lt;set&gt;</code>元素和<code>&lt;where&gt;</code>元素类似，如果其内部条件判断有任何内容返回时，他会插入 SET SQL 片段。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateStudent"</span> <span class="attr">parameterType</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">	update students</span><br><span class="line">	<span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"name != null"</span>&gt;</span>name=#&#123;name&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"email != null"</span>&gt;</span>email=#&#123;email&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"phone != null"</span>&gt;</span>phone=#&#123;phone&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">	where stud_id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这里，如果<if>条件返回了任何文本内容，<code>&lt;set&gt;</code>将会插入 set 关键字和其文本内容，并且会剔除将末尾的 “，”。<br>在上述的例子中，如果 phone!=null,<code>&lt;set&gt;</code>将会让会移除 phone=#{phone}后的逗号“,”，<br>生成 set phone=#{phone} 。</if></p>
<h2 id="MyBaits-食谱"><a href="#MyBaits-食谱" class="headerlink" title="MyBaits 食谱"></a>MyBaits 食谱</h2><p>除了简化数据库编程外，MyBatis 还提供了各种功能，这些对实现一些常用任务非常有用，比如按页加载表数据，存取 CLOB/BLOB 类型的数据，处理枚举类型值，等等。让我们来看看其中一些特性吧。</p>
<h3 id="处理枚举类型"><a href="#处理枚举类型" class="headerlink" title="处理枚举类型"></a>处理枚举类型</h3><p>MyBatis 支持开箱方式持久化 enum 类型属性。假设 STUDENTS 表中有一列 gender（性别）类型为 varchar，存储”MALE”或者“FEMALE”两种值。并且，Student 对象有一个 enum 类型的 gender 属性，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Gender</span><br><span class="line">&#123;</span><br><span class="line">	FEMALE,</span><br><span class="line">	MALE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>默认情况下，MyBatis 使用 EnumTypeHandler 来处理 enum 类型的 Java 属性，并且将其存储为 enum 值的名称。 你不需要为此做任何额外的配置。你可以可以向使用基本数据类型属性一样使用 enum 类型属性，代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String email;</span><br><span class="line">	<span class="keyword">private</span> PhoneNumber phone;</span><br><span class="line">	<span class="keyword">private</span> Address address;</span><br><span class="line">	<span class="keyword">private</span> Gender gender;</span><br><span class="line">	<span class="comment">//setters and getters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertStudent"</span> <span class="attr">parameterType</span>=<span class="string">"Student"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">	insert into students(name,email,addr_id, phone,gender)</span><br><span class="line">	values(#&#123;name&#125;,#&#123;email&#125;,#&#123;address.addrId&#125;,#&#123;phone&#125;,#&#123;gender&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当你执行 insertStudent 语句的时候， MyBatis 会取 Gender 枚举（FEMALE/MALE） 的名称， 然后将其存储到 GENDER列中。<br>如果你希望存储原 enum 的顺序位置，而不是 enum 名，，你需要明确地配置它。<br>如果你想存储 FEMALE 为 0， MALE 为 1 到 gender 列中，你需要在 mybatis-config.xml 文件中配置<br>EnumOrdinalTypeHandler:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">"org.apache.ibatis.type.EnumOrdinalTypeHandler"</span></span></span><br><span class="line"><span class="tag"><span class="attr">javaType</span>=<span class="string">"com.mybatis3.domain.Gender"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>使用顺序位置为值存储到数据库时要当心。 顺序值是根据 enum 中的声明顺序赋值的。如果你改变了 Gender enum 的声明顺序，则数据库存储的数据和此顺序值就不匹配了。</p>
</blockquote>
<h3 id="处理-CLOB-BLOB-类型数据"><a href="#处理-CLOB-BLOB-类型数据" class="headerlink" title="处理 CLOB/BLOB 类型数据"></a>处理 CLOB/BLOB 类型数据</h3><p>MyBatis 提供了内建的对 CLOB/BLOB 类型列的映射处理支持。<br>假设我们有如下的表结构来存储学生和讲师的照片和简介信息：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> USER_PICS</span><br><span class="line">(</span><br><span class="line"><span class="keyword">ID</span> <span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line"><span class="keyword">NAME</span> <span class="built_in">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">PIC <span class="built_in">BLOB</span>,</span><br><span class="line">BIO LONGTEXT,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (<span class="keyword">ID</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=LATIN1;</span><br></pre></td></tr></table></figure></p>
<p>这里，照片可以是 PNG,JPG 或其他格式的。简介信息可以是学生或者讲师的漫长的人生经历。 默认情况下，MyBatis将 CLOB 类型的列映射到 java.lang.String 类型上、 而把 BLOB 列映射到 byte[] 类型上。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserPic</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">byte</span>[] pic;</span><br><span class="line">	<span class="keyword">private</span> String bio;</span><br><span class="line">	<span class="comment">//setters &amp; getters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>创建 UserPicMapper.xml 文件，配置映射语句，代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertUserPic"</span> <span class="attr">parameterType</span>=<span class="string">"UserPic"</span>&gt;</span></span><br><span class="line">	INSERT INTO USER_PICS(NAME, PIC,BIO)</span><br><span class="line">	VALUES(#&#123;name&#125;,#&#123;pic&#125;,#&#123;bio&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserPic"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"UserPic"</span>&gt;</span></span><br><span class="line">	SELECT * FROM USER_PICS WHERE ID=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>下列的 insertUserPic()展示了如何将数据插入到 CLOB/BLOB 类型的列上：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUserPic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">byte</span>[] pic = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			File file = <span class="keyword">new</span> File(<span class="string">"C:\\Images\\UserImg.jpg"</span>);</span><br><span class="line">			InputStream is = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">			pic = <span class="keyword">new</span> <span class="keyword">byte</span>[is.available()];</span><br><span class="line">			is.read(pic);</span><br><span class="line">			is.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		String name = <span class="string">"UserName"</span>;</span><br><span class="line"></span><br><span class="line">		String bio = <span class="string">"put some lenghty bio here"</span>;</span><br><span class="line">		UserPic userPic = <span class="keyword">new</span> UserPic(<span class="number">0</span>, name, pic, bio);</span><br><span class="line">		SqlSession sqlSession = MyBatisUtil.openSession();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			UserPicMapper mapper = sqlSession.getMapper(UserPicMapper.class);</span><br><span class="line">			mapper.insertUserPic(userPic);</span><br><span class="line">			sqlSession.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			sqlSession.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>下面的 getUserPic()方法展示了怎样将 CLOB 类型数据读取到 String 类型，BLOB 类型数据读取成 byte[]属性：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUserPic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		UserPic userPic = <span class="keyword">null</span>;</span><br><span class="line">		SqlSession sqlSession = MyBatisUtil.openSession();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			UserPicMapper mapper = sqlSession.getMapper(UserPicMapper.class);</span><br><span class="line">			userPic = mapper.getUserPic(<span class="number">1</span>);</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			sqlSession.close();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">byte</span>[] pic = userPic.getPic();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			OutputStream os = <span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(<span class="string">"C:\\Images\\UserImage_FromDB.jpg"</span>));</span><br><span class="line">			os.write(pic);</span><br><span class="line">			os.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="传入多个输入参数"><a href="#传入多个输入参数" class="headerlink" title="传入多个输入参数"></a>传入多个输入参数</h3><p>MyBatis 中的映射语句有一个 parameterType 属性来制定输入参数的类型。如果我们想给映射语句传入多个参数的话，我们可以将所有的输入参数放到 HashMap 中，将 HashMap 传递给映射语句。<br>MyBatis 还提供了另外一种传递多个输入参数给映射语句的方法。假设我们想通过给定的 name 和 email 信息查找学生信息，定义查询接口如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Public <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="function">List&lt;Student&gt; <span class="title">findAllStudentsByNameEmail</span><span class="params">(String name, String email)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>MyBatis 支持 将多个输入参数传递给映射语句，并以#{param}的语法形式引用它们：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllStudentsByNameEmail"</span> <span class="attr">resultMap</span>=<span class="string">"StudentResult"</span>&gt;</span></span><br><span class="line">	select stud_id, name,email, phone from Students</span><br><span class="line">	where name=#&#123;param1&#125; and email=#&#123;param2&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这里#{param1}引用第一个参数 name，而#{param2}引用了第二个参数 email。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">StudentMapper studentMapper = sqlSession.getMapper(StudentMapper.class);</span><br><span class="line">studentMapper.findAllStudentsByNameEmail(name, email);</span><br></pre></td></tr></table></figure></p>
<h3 id="多行结果集映射成-Map"><a href="#多行结果集映射成-Map" class="headerlink" title="多行结果集映射成 Map"></a>多行结果集映射成 Map</h3><p>如果你有一个映射语句返回多行记录，并且你想以 HashMap 的形式存储记录的值，使用记录列名作为 key 值，而记录对应值或为 value 值。我们可以使用 sqlSession.selectMap(),如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">" findAllStudents"</span> <span class="attr">resultMap</span>=<span class="string">"StudentResult"</span>&gt;</span></span><br><span class="line">	select * from Students</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;Integer, Student&gt; studentMap = sqlSession.selectMap(<span class="string">"com.mybatis3.mappers.StudentMapper.findAllStudents"</span>, <span class="string">"studId"</span>);</span><br></pre></td></tr></table></figure>
<p>这里 studentMap 将会将 studId 作为 key 值，而 Student 对象作为 value 值。</p>
<h3 id="使用-RowBounds-对结果集进行分页"><a href="#使用-RowBounds-对结果集进行分页" class="headerlink" title="使用 RowBounds 对结果集进行分页"></a>使用 RowBounds 对结果集进行分页</h3><p>有时候，我们会需要跟海量的数据打交道，比如一个有数百万条数据级别的表。 由于计算机内存的现实我们不可能一次性加载这么多数据，我们可以获取到数据的一部分。特别是在 Web 应用程序中，分页机制被用来以一页一页的形式展示海量的数据。<br>MyBatis 可以使用 RowBounds 逐页加载表数据。 RowBounds 对象可以使用 offset 和 limit 参数来构建。 参数offset 表示开始位置，而 limit 表示要取的记录的数目。<br>假设如果你想每页加载并显示 25 条学生的记录，你可以使用如下的代码：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllStudents"</span> <span class="attr">resultMap</span>=<span class="string">"StudentResult"</span>&gt;</span></span><br><span class="line">	select * from Students</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>然后，你可以加载如下加载第一页数据（前 25 条）:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> offset =<span class="number">0</span> , limit =<span class="number">25</span>;</span><br><span class="line">RowBounds rowBounds = <span class="keyword">new</span> RowBounds(offset, limit);</span><br><span class="line">List&lt;Student&gt; = studentMapper.getStudents(rowBounds);</span><br></pre></td></tr></table></figure>
<p>若要展示第二页，使用 offset=25,limit=25;第三页，则为 offset=50，limit=25。</p>
<h3 id="使用-ResultSetHandler-自定义结果集-ResultSet-处理"><a href="#使用-ResultSetHandler-自定义结果集-ResultSet-处理" class="headerlink" title="使用 ResultSetHandler 自定义结果集 ResultSet 处理"></a>使用 ResultSetHandler 自定义结果集 ResultSet 处理</h3><p>MyBatis 在将查询结果集映射到 JavaBean 方面提供了很大的选择性。 但是，有时候我们会遇到由于特定的目的，需要我们自己处理 SQL 查询结果的情况。 MyBatis 提供了 ResultHandler 插件形式允许我们以任何自己喜欢的方式处理结果集 ResultSet。<br>假设我们想从学生的 stud_id 被用作 key，而 name 被用作 value 的 HashMap 中获取到 student 信息。</p>
<blockquote>
<p>mybatis-3.2.2 并不支持使用 resultMap 配置将查询的结果集映射成一个属性为key，而另外属性为 value 的 HashMap。<br>sqlSession.selectMap()则可以返回 以给定列为 key，记录对象为 value 的 map。<br>我们不能将其配置成使用其中一个属性作为 key，而另外的属性作为 value。</p>
</blockquote>
<p>对于 sqlSession.select()方法，我们可以传递给它一个 ResultHandler 的实现，它会被调用来处理 ResultSet的每一条记录。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ResultHandler</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">handleResult</span><span class="params">(ResultContext context)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>现在然我们来看一下怎么使用 ResultHandler 来处理结果集 ResultSet，并返回自定义化的结果。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;Integer, String&gt; <span class="title">getStudentIdNameMap</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">final</span> Map&lt;Integer, String&gt; map = <span class="keyword">new</span> HashMap&lt;Integer, String&gt;();</span><br><span class="line">		SqlSession sqlSession = MyBatisUtil.openSession();</span><br><span class="line">		<span class="keyword">try</span></span><br><span class="line">		&#123;</span><br><span class="line">			sqlSession.select(<span class="string">"com.mybatis3.mappers.StudentMapper.findAllStudents"</span>,</span><br><span class="line">			<span class="keyword">new</span> ResultHandler()&#123;</span><br><span class="line">				<span class="meta">@Override</span></span><br><span class="line">				<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleResult</span><span class="params">(ResultContext context)</span></span>&#123;</span><br><span class="line">					Student student = (Student) context.getResultObject();</span><br><span class="line">					map.put(student.getStudId(), student.getName());</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">finally</span></span><br><span class="line">		&#123;</span><br><span class="line">			sqlSession.close();</span><br><span class="line">		&#125;</span><br><span class="line">			<span class="keyword">return</span> map;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>在上述的代码中，我们提供了匿名内部 ResultHandler 实现类，在 handleResult()方法中，我们使用context.getResultObject()获取当前的 result 对象，即 Student 对象，因为我们定义了 findAllStudent 映射语句的 resultMap=”studentResult“。对查询返回的每一行都会调用 handleResult()方法，并且我们从 Student 对象中取出 studId 和 name，将其放到 map 中。</p>
<h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><p>将从数据库中加载的数据缓存到内存中，是很多应用程序为了提高性能而采取的一贯做法。 MyBatis 对通过映射的SELECT 语句加载的查询结果提供了内建的缓存支持。默认情况下，启用一级缓存；即，如果你使用同一个 SqlSession接口对象调用了相同的 SELECT 语句，则直接会从缓存中返回结果，而不是再查询一次数据库。<br>我们可以在 SQL 映射器 XML 配置文件中使用<code>&lt;cache /&gt;</code>元素添加全局二级缓存。<br>当你加入了<code>&lt;cache /&gt;</code>元素，将会出现以下情况：</p>
<ul>
<li>所有的在映射语句文件定义的<code>&lt;select&gt;</code>语句的查询结果都会被缓存</li>
<li>所有的在映射语句文件定义的<code>&lt;insert&gt;</code>,<code>&lt;update&gt;</code> 和<code>&lt;delete&gt;</code>语句将会刷新缓存</li>
<li>缓存根据最近最少被使用（Least Recently Used，LRU）算法管理</li>
<li>缓存不会被任何形式的基于时间表的刷新（没有刷新时间间隔） ，即不支持定时刷新机制</li>
<li>缓存将存储 1024 个 查询方法返回的列表或者对象的引用</li>
<li>缓存会被当作一个读/写缓存。 这是指检索出的对象不会被共享，并且可以被调用者安全地修改，不会其他潜<br>在的调用者或者线程的潜在修改干扰。（即，缓存是线程安全的）<br>你也可以通过复写默认属性来自定义缓存的行为，如下所示：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">eviction</span>=<span class="string">"FIFO"</span> <span class="attr">flushInterval</span>=<span class="string">"60000"</span> <span class="attr">size</span>=<span class="string">"512"</span> <span class="attr">readOnly</span>=<span class="string">"true"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>以下是对上述属性的描述：</p>
<ul>
<li>eviction:此处定义缓存的移除机制。默认值是 LRU，其可能的值有：LRU（least recently used,最近最<br>少使用）,FIFO(first in first out,先进先出)，SOFT(soft reference,软引用)，WEAK（weakreference,弱引用） 。</li>
<li>flushInterval:定义缓存刷新间隔，以毫秒计。默认情况下不设置。所以不使用刷新间隔，缓存 cache 只<br>有调用语句的时候刷新。</li>
<li>size:此表示缓存 cache 中能容纳的最大元素数。默认值是 1024，你可以设置成任意的正整数。</li>
<li>readOnly:一个只读的缓存 cache 会对所有的调用者返回被缓存对象的同一个实例（实际返回的是被返回对<br>象的一份引用）。一个读/写缓存 cache 将会返回被返回对象的一分拷贝（通过序列化） 。默认情况下设<br>置为 false。 可能的值有 false 和 true。<br>一个缓存的配置和缓存实例被绑定到映射器配置文件所在的名空间（namespace）上，所以在相同名空间内的所有语句被绑定到一个 cache 中。</li>
</ul>
<p>默认的映射语句的 cache 配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">...</span> <span class="attr">flushCache</span>=<span class="string">"false"</span> <span class="attr">useCache</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">...</span> <span class="attr">flushCache</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">...</span> <span class="attr">flushCache</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">...</span> <span class="attr">flushCache</span>=<span class="string">"true"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>你可以为任意特定的映射语句复写默认的 cache 行为；例如，对一个 select 语句不使用缓存，可以设置<br>useCache=“false”。<br>除了内建的缓存支持，MyBatis 也提供了与第三方缓存类库如 Ehcache，OSCache，Hazelcast 的集成支持。 你可以在 MyBatis 官方网站 <a href="https://code.google.com/p/mybatis/wiki/Caches" target="_blank" rel="noopener">https://code.google.com/p/mybatis/wiki/Caches</a> 上找到关于继承第三方缓存类库的更多信息。</p>
<h1 id="使用注解配置-SQL-映射器"><a href="#使用注解配置-SQL-映射器" class="headerlink" title="使用注解配置 SQL 映射器"></a>使用注解配置 SQL 映射器</h1><p>在上一章，我们看到了我们是怎样在映射器 Mapper XML 配置文件中配置映射语句的。 MyBatis 也支持使用注解来<br>配置映射语句。当我们使用基于注解的映射器接口时，我们不再需要在 XML 配置文件中配置了。 如果你愿意，你也可以同时使用基于 XML 和基于注解的映射语句。<br>本章将涵盖以下话题：</p>
<ul>
<li>在映射器 Mapper 接口上使用注解</li>
<li>映射语句</li>
<li>@Insert， @Update， @Delete,@SeelctStatements</li>
<li>结果映射</li>
<li>一对一映射</li>
<li>一对多映射</li>
<li>动态 SQL<ul>
<li>@SelectProvider</li>
<li>@InsertProvider</li>
<li>@UpdateProvider</li>
<li>@DeleteProvider</li>
</ul>
</li>
</ul>
<h2 id="在映射器-Mapper-接口上使用注解"><a href="#在映射器-Mapper-接口上使用注解" class="headerlink" title="在映射器 Mapper 接口上使用注解"></a>在映射器 Mapper 接口上使用注解</h2><p>MyBatis 对于大部分的基于 XML 的映射器元素（包括<code>&lt;select&gt;</code>,<code>&lt;update&gt;</code>）提供了对应的基于注解的配置项。然而在某些情况下，基于注解配置 还不能支持基于 XML 的一些元素。</p>
<h3 id="映射语句-1"><a href="#映射语句-1" class="headerlink" title="映射语句"></a>映射语句</h3><p>MyBatis 提供了多种注解来支持不同类型的语句(statement)如 SELECT,INSERT,UPDATE,DELETE。 让我们看一下具体怎样配置映射语句。</p>
<ol>
<li>@Insert</li>
</ol>
<p>我们可以使用@Insert 注解来定义一个 INSERT 映射语句：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mybatis3.mappers;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="meta">@Insert</span>(<span class="string">"INSERT INTO STUDENTS(STUD_ID,NAME,EMAIL,ADDR_ID, PHONE)</span></span><br><span class="line"><span class="string">		VALUES(#&#123;studId&#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;address.addrId&#125;,#&#123;phone&#125;)"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">insertStudent</span><span class="params">(Student student)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>使用了@Insert 注解的 insertMethod()方法将返回 insert 语句执行后影响的行数。</p>
<p><strong>自动生成主键</strong><br>在上一章中我们讨论过主键列值可以自动生成。我们可以使用@Options 注解的 userGeneratedKeys 和keyProperty 属性让数据库产生 auto_increment（自增长）列的值，然后将生成的值设置到输入参数对象的属性中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert</span>(<span class="string">"INSERT INTO STUDENTS(NAME,EMAIL,ADDR_ID, PHONE)</span></span><br><span class="line"><span class="string">	VALUES(#&#123;name&#125;,#&#123;email&#125;,#&#123;address.addrId&#125;,#&#123;phone&#125;)"</span>)</span><br><span class="line"><span class="meta">@Options</span>(useGeneratedKeys = <span class="keyword">true</span>, keyProperty = <span class="string">"studId"</span>)</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insertStudent</span><span class="params">(Student student)</span></span>;</span><br></pre></td></tr></table></figure>
<p>这里 STUD_ID 列值将会通过 MySQL 数据库自动生成。并且生成的值将会被设置到 student 对象的 studId 属性中。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);</span><br><span class="line">mapper.insertStudent(student);</span><br><span class="line"><span class="keyword">int</span> studentId = student.getStudId();</span><br></pre></td></tr></table></figure></p>
<p>有一些数据库如 Oracle，并不支持 AUTO_INCREMENT 列属性，它使用序列（SEQUENCE）来产生主键的值。</p>
<p>我们可以使用@SelectKey 注解来为任意 SQL 语句来指定主键值，作为主键列的值。<br>假设我们有一个名为 STUD_ID_SEQ 的序列来生成 STUD_ID 主键值。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert</span>(<span class="string">"INSERT INTO STUDENTS(STUD_ID,NAME,EMAIL,ADDR_ID, PHONE)</span></span><br><span class="line"><span class="string">VALUES(#&#123;studId&#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;address.addrId&#125;,#&#123;phone&#125;)"</span>)</span><br><span class="line"><span class="meta">@SelectKey</span>(statement=<span class="string">"SELECT STUD_ID_SEQ.NEXTVAL FROM DUAL"</span>,</span><br><span class="line">keyProperty=<span class="string">"studId"</span>, resultType=<span class="keyword">int</span>.class, before=<span class="keyword">true</span>)</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insertStudent</span><span class="params">(Student student)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>这里我们使用了@SelectKey 来生成主键值，并且存储到了 student 对象的 studId 属性上。 由于我们设置了<br>before=true,该语句将会在执行 INSERT 语句之前执行。<br>如果你使用序列作为触发器来设置主键值，我们可以在 INSERT 语句执行后，从 sequence_name.currval 获取数据库产生的主键值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert</span>(<span class="string">"INSERT INTO STUDENTS(NAME,EMAIL,ADDR_ID, PHONE)</span></span><br><span class="line"><span class="string">VALUES(#&#123;name&#125;,#&#123;email&#125;,#&#123;address.addrId&#125;,#&#123;phone&#125;)"</span>)</span><br><span class="line"><span class="meta">@SelectKey</span>(statement=<span class="string">"SELECT STUD_ID_SEQ.CURRVAL FROM DUAL"</span>,</span><br><span class="line">keyProperty=<span class="string">"studId"</span>, resultType=<span class="keyword">int</span>.class, before=<span class="keyword">false</span>)</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insertStudent</span><span class="params">(Student student)</span></span>;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>@Update</li>
</ol>
<p>我们可以使用@Update 注解来定义一个 UPDATE 映射语句，如下所示：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Update</span>(<span class="string">"UPDATE STUDENTS SET NAME=#&#123;name&#125;, EMAIL=#&#123;email&#125;,</span></span><br><span class="line"><span class="string">PHONE=#&#123;phone&#125; WHERE STUD_ID=#&#123;studId&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">updateStudent</span><span class="params">(Student student)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>使用了@Update 的 updateStudent()方法将会返回执行了 update 语句后影响的行数。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);</span><br><span class="line"><span class="keyword">int</span> noOfRowsUpdated = mapper.updateStudent(student);</span><br></pre></td></tr></table></figure></p>
<ol start="3">
<li>@Delete</li>
</ol>
<p>我们可以使用@Delete 注解来定义一个 DELETE 映射语句，如下所示：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Delete</span>(<span class="string">"DELETE FROM STUDENTS WHERE STUD_ID=#&#123;studId&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">deleteStudent</span><span class="params">(<span class="keyword">int</span> studId)</span></span>;</span><br></pre></td></tr></table></figure></p>
<ol start="4">
<li>@Select</li>
</ol>
<p>我们可以使用@ Select 注解来定义一个 SELECT 映射语句。<br>让我们看一下怎样使用注解配置一个简单的 select 查询。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mybatis3.mappers;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="meta">@Select</span>(<span class="string">"SELECT STUD_ID AS STUDID, NAME, EMAIL, PHONE FROM</span></span><br><span class="line"><span class="string">	STUDENTS WHERE STUD_ID=#&#123;studId&#125;"</span>)</span><br><span class="line">	<span class="function">Student <span class="title">findStudentById</span><span class="params">(Integer studId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>为了将列名和 Student bean 属性名匹配，我们为 stud_id 起了一个 studId 的别名。如果返回了多行结果，将抛出 TooManyResultsException 异常。</p>
<h3 id="结果映射"><a href="#结果映射" class="headerlink" title="结果映射"></a>结果映射</h3><p>我们可以将查询结果通过别名或者是@Results 注解与 JavaBean 属性映射起来。<br>现在让我们看看怎样使用@Results 注解将指定列于指定 JavaBean 属性映射器来，执行 SELECT 查询的：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mybatis3.mappers;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="meta">@Select</span>(<span class="string">"SELECT * FROM STUDENTS"</span>)</span><br><span class="line">	<span class="meta">@Results</span>(</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="meta">@Result</span>(id = <span class="keyword">true</span>, column = <span class="string">"stud_id"</span>, property = <span class="string">"studId"</span>),</span><br><span class="line">	<span class="meta">@Result</span>(column = <span class="string">"name"</span>, property = <span class="string">"name"</span>),</span><br><span class="line">	<span class="meta">@Result</span>(column = <span class="string">"email"</span>, property = <span class="string">"email"</span>),</span><br><span class="line">	<span class="meta">@Result</span>(column = <span class="string">"addr_id"</span>, property = <span class="string">"address.addrId"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="function">List&lt;Student&gt; <span class="title">findAllStudents</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>@Results 注解和映射器 XML 配置文件元素<resultmap>想对应。 然而，MyBatis3.2.2 不能为@Results 注解赋予一个 ID。 所以，不像<resultmap>元素，我们不应在不同的映射语句中重用@Results 声明。这意味着即使@Results注解完全相同，我们也需要(在不同的映射接口中)重复@Results 声明。</resultmap></resultmap></p>
</blockquote>
<p>例如，看下面的 findStudentById()和 findAllStudents()方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select</span>(<span class="string">"SELECT * FROM STUDENTS WHERE STUD_ID=#&#123;studId&#125;"</span>)</span><br><span class="line"><span class="meta">@Results</span>(</span><br><span class="line">&#123;</span><br><span class="line">	<span class="meta">@Result</span>(id = <span class="keyword">true</span>, column = <span class="string">"stud_id"</span>, property = <span class="string">"studId"</span>),</span><br><span class="line">	<span class="meta">@Result</span>(column = <span class="string">"name"</span>, property = <span class="string">"name"</span>),</span><br><span class="line">	<span class="meta">@Result</span>(column = <span class="string">"email"</span>, property = <span class="string">"email"</span>),</span><br><span class="line">	<span class="meta">@Result</span>(column = <span class="string">"addr_id"</span>, property = <span class="string">"address.addrId"</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="function">Student <span class="title">findStudentById</span><span class="params">(<span class="keyword">int</span> studId)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Select</span>(<span class="string">"SELECT * FROM STUDENTS"</span>)</span><br><span class="line"><span class="meta">@Results</span>(</span><br><span class="line">&#123;</span><br><span class="line">	<span class="meta">@Result</span>(id = <span class="keyword">true</span>, column = <span class="string">"stud_id"</span>, property = <span class="string">"studId"</span>),</span><br><span class="line">	<span class="meta">@Result</span>(column = <span class="string">"name"</span>, property = <span class="string">"name"</span>),</span><br><span class="line">	<span class="meta">@Result</span>(column = <span class="string">"email"</span>, property = <span class="string">"email"</span>),</span><br><span class="line">	<span class="meta">@Result</span>(column = <span class="string">"addr_id"</span>, property = <span class="string">"address.addrId"</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="function">List&lt;Student&gt; <span class="title">findAllStudents</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>这里两个语句的@Results 配置完全相同，但是我必须得重复它。 这里有一个解决方法。 我们可以创建一个映射器Mapper 配置文件， 然后配置<resultmap>元素，然后使用@ResultMap 注解引用此<resultmap>。<br>在 StudentMapper.xml 中定义一个 ID 为 StudentResult 的<resultmap>。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.mybatis3.mappers.StudentMapper"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Student"</span> <span class="attr">id</span>=<span class="string">"StudentResult"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"studId"</span> <span class="attr">column</span>=<span class="string">"stud_id"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"email"</span> <span class="attr">column</span>=<span class="string">"email"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"phone"</span> <span class="attr">column</span>=<span class="string">"phone"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></resultmap></resultmap></resultmap></p>
<p>在 StudentMapper.java 中，使用@ResultMap 引用名为 StudentResult 的 resultMap。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="meta">@Select</span>(<span class="string">"SELECT * FROM STUDENTS WHERE STUD_ID=#&#123;studId&#125;"</span>)</span><br><span class="line">	<span class="meta">@ResultMap</span>(<span class="string">"com.mybatis3.mappers.StudentMapper.StudentResult"</span>)</span><br><span class="line">	<span class="function">Student <span class="title">findStudentById</span><span class="params">(<span class="keyword">int</span> studId)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Select</span>(<span class="string">"SELECT * FROM STUDENTS"</span>)</span><br><span class="line">	<span class="meta">@ResultMap</span>(<span class="string">"com.mybatis3.mappers.StudentMapper.StudentResult"</span>)</span><br><span class="line">	<span class="function">List&lt;Student&gt; <span class="title">findAllStudents</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="一对一映射-1"><a href="#一对一映射-1" class="headerlink" title="一对一映射"></a>一对一映射</h3><p>MyBatis 提供了@One 注解来使用嵌套 select 语句（Nested-Select）加载一对一关联查询数据。<br>让我们看看怎样使用@One 注解获取学生及其地址信息。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="meta">@Select</span>(<span class="string">"SELECT ADDR_ID AS ADDRID, STREET, CITY, STATE, ZIP, COUNTRY</span></span><br><span class="line"><span class="string">	FROM ADDRESSES WHERE ADDR_ID=#&#123;id&#125;"</span>)</span><br><span class="line">	<span class="function">Address <span class="title">findAddressById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Select</span>(<span class="string">"SELECT * FROM STUDENTS WHERE STUD_ID=#&#123;studId&#125; "</span>)</span><br><span class="line">	<span class="meta">@Results</span>(</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="meta">@Result</span>(id = <span class="keyword">true</span>, column = <span class="string">"stud_id"</span>, property = <span class="string">"studId"</span>),</span><br><span class="line">	<span class="meta">@Result</span>(column = <span class="string">"name"</span>, property = <span class="string">"name"</span>),</span><br><span class="line">	<span class="meta">@Result</span>(column = <span class="string">"email"</span>, property = <span class="string">"email"</span>),</span><br><span class="line">	<span class="meta">@Result</span>(property = <span class="string">"address"</span>, column = <span class="string">"addr_id"</span>,</span><br><span class="line">	one = <span class="meta">@One</span>(select = <span class="string">"com.mybatis3.mappers.StudentMapper.</span></span><br><span class="line"><span class="string">	findAddressById"</span>))</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="function">Student <span class="title">selectStudentWithAddress</span><span class="params">(<span class="keyword">int</span> studId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里我们使用了@One 注解的 select 属性来指定一个使用了完全限定名的方法上，该方法会返回一个 Address 对象。 使用 column=”addr_id”,则 STUEDNTS 表中列 addr_id 的值将会作为输入参数传递给findAddressById()方法。<br>如果@One SELECT 查询返回了多行结果，则会抛出 TooManyResultsException 异常。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> studId = <span class="number">1</span>;</span><br><span class="line">StudentMapper studentMapper =</span><br><span class="line">sqlSession.getMapper(StudentMapper.class);</span><br><span class="line">Student student = studentMapper.selectStudentWithAddress(studId);</span><br><span class="line">System.out.println(<span class="string">"Student :"</span>+student);</span><br><span class="line">System.out.println(<span class="string">"Address :"</span>+student.getAddress());</span><br></pre></td></tr></table></figure></p>
<p>在第三章，使用 XML 配置 SQL 映射器中我们讨论过，我们可以通过基于 XML 的映射器配置， 使用嵌套结果 ResultMap来加载一对一关联的查询。 而 MyBatis3.2.2 版本，并没有对应的注解支持。但是我们可以在映射器 Mapper 配置文件中配置<resultmap>并且使用@ResultMap 注解来引用它。<br>在 StudentMapper.xml 中配置<resultmap>，如下所示：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.mybatis3.mappers.StudentMapper"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Address"</span> <span class="attr">id</span>=<span class="string">"AddressResult"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"addrId"</span> <span class="attr">column</span>=<span class="string">"addr_id"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"street"</span> <span class="attr">column</span>=<span class="string">"street"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"city"</span> <span class="attr">column</span>=<span class="string">"city"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"state"</span> <span class="attr">column</span>=<span class="string">"state"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"zip"</span> <span class="attr">column</span>=<span class="string">"zip"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"country"</span> <span class="attr">column</span>=<span class="string">"country"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Student"</span> <span class="attr">id</span>=<span class="string">"StudentWithAddressResult"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"studId"</span> <span class="attr">column</span>=<span class="string">"stud_id"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"email"</span> <span class="attr">column</span>=<span class="string">"email"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">resultMap</span>=<span class="string">"AddressResult"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></resultmap></resultmap></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="meta">@Select</span>(<span class="string">"select stud_id, name, email, a.addr_id, street, city,</span></span><br><span class="line"><span class="string">		state, zip, country"</span> + <span class="string">" FROM students s left outer join addresses a</span></span><br><span class="line"><span class="string">		on s.addr_id=a.addr_id"</span> + <span class="string">" where stud_id=#&#123;studId&#125; "</span>)</span><br><span class="line">	<span class="meta">@ResultMap</span>(<span class="string">"com.mybatis3.mappers.StudentMapper.</span></span><br><span class="line"><span class="string">	StudentWithAddressResult"</span>)</span><br><span class="line">	<span class="function">Student <span class="title">selectStudentWithAddress</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="一对多映射-1"><a href="#一对多映射-1" class="headerlink" title="一对多映射"></a>一对多映射</h3><p>MyBatis 提供了@Many 注解，用来使用嵌套 Select 语句加载一对多关联查询。<br>现在让我们看一下如何使用@Many 注解获取一个讲师及其教授课程列表信息：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TutorMapper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="meta">@Select</span>(<span class="string">"select addr_id as addrId, street, city, state, zip,</span></span><br><span class="line"><span class="string">	country from addresses where addr_id=#&#123;id&#125;"</span>)</span><br><span class="line">	<span class="function">Address <span class="title">findAddressById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Select</span>(<span class="string">"select * from courses where tutor_id=#&#123;tutorId&#125;"</span>)</span><br><span class="line">	<span class="meta">@Results</span>(</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="meta">@Result</span>(id = <span class="keyword">true</span>, column = <span class="string">"course_id"</span>, property = <span class="string">"courseId"</span>),</span><br><span class="line">	<span class="meta">@Result</span>(column = <span class="string">"name"</span>, property = <span class="string">"name"</span>),</span><br><span class="line">	<span class="meta">@Result</span>(column = <span class="string">"description"</span>, property = <span class="string">"description"</span>),</span><br><span class="line">	<span class="meta">@Result</span>(column = <span class="string">"start_date"</span> property = <span class="string">"startDate"</span>),</span><br><span class="line">	<span class="meta">@Result</span>(column = <span class="string">"end_date"</span> property = <span class="string">"endDate"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="function">List&lt;Course&gt; <span class="title">findCoursesByTutorId</span><span class="params">(<span class="keyword">int</span> tutorId)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Select</span>(<span class="string">"SELECT tutor_id, name as tutor_name, email, addr_id</span></span><br><span class="line"><span class="string">	FROM tutors where tutor_id=#&#123;tutorId&#125;"</span>)</span><br><span class="line">	<span class="meta">@Results</span>(</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="meta">@Result</span>(id = <span class="keyword">true</span>, column = <span class="string">"tutor_id"</span>, property = <span class="string">"tutorId"</span>),</span><br><span class="line">	<span class="meta">@Result</span>(column = <span class="string">"tutor_name"</span>, property = <span class="string">"name"</span>),</span><br><span class="line">	<span class="meta">@Result</span>(column = <span class="string">"email"</span>, property = <span class="string">"email"</span>),</span><br><span class="line">	<span class="meta">@Result</span>(property = <span class="string">"address"</span>, column = <span class="string">"addr_id"</span>,</span><br><span class="line">	one = <span class="meta">@One</span>(select = <span class="string">" com.mybatis3.</span></span><br><span class="line"><span class="string">	mappers.TutorMapper.findAddressById"</span>)),</span><br><span class="line">	<span class="meta">@Result</span>(property = <span class="string">"courses"</span>, column = <span class="string">"tutor_id"</span>,</span><br><span class="line">	many = <span class="meta">@Many</span>(select = <span class="string">"com.mybatis3.mappers.TutorMapper.</span></span><br><span class="line"><span class="string">	findCoursesByTutorId"</span>))</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="function">Tutor <span class="title">findTutorById</span><span class="params">(<span class="keyword">int</span> tutorId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里我们使用了@Many 注解的 select 属性来指向一个完全限定名称的方法，该方法将返回一个<code>List&lt;Course&gt;</code>对象。使用 column=”tutor_id”，TUTORS 表中的 tutor_id 列值将会作为输入参数传递给 findCoursesByTutorId()方法。<br>在第三章，使用 XML 配置 SQL 映射器中我们讨论过，我们可以通过基于 XML 的映射器配置， 使用嵌套结果 ResultMap来加载一对多关联的查询。 而 MyBatis3.2.2 版本，并没有对应的注解支持。但是我们可以在映射器 Mapper 配置文件中配置<code>&lt;resultMap&gt;</code>并且使用@ResultMap 注解来引用它。<br>在 TutorMapper.xml 中配置<code>&lt;resultMap&gt;</code>,如下所示：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.mybatis3.mappers.TutorMapper"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Address"</span> <span class="attr">id</span>=<span class="string">"AddressResult"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"addrId"</span> <span class="attr">column</span>=<span class="string">"addr_id"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"street"</span> <span class="attr">column</span>=<span class="string">"street"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"city"</span> <span class="attr">column</span>=<span class="string">"city"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"state"</span> <span class="attr">column</span>=<span class="string">"state"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"zip"</span> <span class="attr">column</span>=<span class="string">"zip"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"country"</span> <span class="attr">column</span>=<span class="string">"country"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Course"</span> <span class="attr">id</span>=<span class="string">"CourseResult"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"course_id"</span> <span class="attr">property</span>=<span class="string">"courseId"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"description"</span> <span class="attr">property</span>=<span class="string">"description"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"start_date"</span> <span class="attr">property</span>=<span class="string">"startDate"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"end_date"</span> <span class="attr">property</span>=<span class="string">"endDate"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Tutor"</span> <span class="attr">id</span>=<span class="string">"TutorResult"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"tutor_id"</span> <span class="attr">property</span>=<span class="string">"tutorId"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"tutor_name"</span> <span class="attr">property</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"email"</span> <span class="attr">property</span>=<span class="string">"email"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">resultMap</span>=<span class="string">"AddressResult"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"courses"</span> <span class="attr">resultMap</span>=<span class="string">"CourseResult"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TutorMapper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="meta">@Select</span>(<span class="string">"SELECT T.TUTOR_ID, T.NAME AS TUTOR_NAME, EMAIL,</span></span><br><span class="line"><span class="string">			A.ADDR_ID, STREET, CITY, STATE, ZIP, COUNTRY, COURSE_ID, C.NAME,</span></span><br><span class="line"><span class="string">			DESCRIPTION, START_DATE, END_DATE FROM TUTORS T LEFT OUTER</span></span><br><span class="line"><span class="string">			JOIN ADDRESSES A ON T.ADDR_ID=A.ADDR_ID LEFT OUTER JOIN COURSES</span></span><br><span class="line"><span class="string">			C ON T.TUTOR_ID=C.TUTOR_ID WHERE T.TUTOR_ID=#&#123;tutorId&#125;"</span>)</span><br><span class="line">	<span class="meta">@ResultMap</span>(<span class="string">"com.mybatis3.mappers.TutorMapper.TutorResult"</span>)</span><br><span class="line">	<span class="function">Tutor <span class="title">selectTutorById</span><span class="params">(<span class="keyword">int</span> tutorId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="动态-SQL-1"><a href="#动态-SQL-1" class="headerlink" title="动态 SQL"></a>动态 SQL</h2><p>有 时 候 我 们 需 要 根 据 输 入 条 件 动 态 地 构 建 SQL 语 句 。 MyBatis 提 供 了 各 种 注 解 如@InsertProvider,@UpdateProvider,@DeleteProvider 和@SelectProvider，来帮助构建动态 SQL 语句，然后让MyBatis 执行这些 SQL 语句。</p>
<h3 id="SelectProvider"><a href="#SelectProvider" class="headerlink" title="@SelectProvider"></a>@SelectProvider</h3><p>现在让我们来看一个使用@SelectProvider 注解来创建一个简单的 SELECT 映射语句的例子。<br>创建一个 TutorDynaSqlProvider.java 类，以及 findTutorByIdSql()方法，如下所示：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mybatis3.sqlproviders;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.jdbc.SQL;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TutorDynaSqlProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">findTutorByIdSql</span><span class="params">(<span class="keyword">int</span> tutorId)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"SELECT TUTOR_ID AS tutorId, NAME, EMAIL FROM TUTORS</span></span><br><span class="line"><span class="string">		WHERE TUTOR_ID="</span> + tutorId;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在 TutorMapper.java 接口中创建一个映射语句，如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SelectProvider</span>(type=TutorDynaSqlProvider.class, method=<span class="string">"findTutorByIdSql"</span>)</span><br><span class="line"><span class="function">Tutor <span class="title">findTutorById</span><span class="params">(<span class="keyword">int</span> tutorId)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>这里我们使用了@SelectProvider 来指定了一个类，及其内部的方法，用来提供需要执行的 SQL 语句。<br>但是使用字符串拼接的方法唉构建 SQL 语句是非常困难的，并且容易出错。所以 MyBaits 提供了一个 SQL 工具类不使用字符串拼接的方式，简化构造动态 SQL 语句。<br>现在，让我们看看如何使用 org.apache.ibatis.jdbc.SQL 工具类来准备相同的 SQL 语句。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mybatis3.sqlproviders;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.jdbc.SQL;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TutorDynaSqlProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">findTutorByIdSql</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> tutorId)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SQL()&#123;</span><br><span class="line">			&#123;</span><br><span class="line">				SELECT(<span class="string">"tutor_id as tutorId, name, email"</span>);</span><br><span class="line">				FROM(<span class="string">"tutors"</span>);</span><br><span class="line">				WHERE(<span class="string">"tutor_id="</span> + tutorId);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; .toString();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>SQL 工具类会处理以合适的空格前缀和后缀来构造 SQL 语句。<br>动态 SQL provider 方法可以接收以下其中一种参数：</p>
<ul>
<li>无参数</li>
<li>和映射器 Mapper 接口的方法同类型的参数</li>
<li>java.util.Map<br>如果 SQL 语句的准备不取决于输入参数，你可以使用不带参数的 SQL Provider 方法。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">findTutorByIdSql</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> SQL()</span><br><span class="line">	&#123;</span><br><span class="line">		&#123;</span><br><span class="line">			SELECT(<span class="string">"tutor_id as tutorId, name, email"</span>);</span><br><span class="line">			FROM(<span class="string">"tutors"</span>);</span><br><span class="line">			WHERE(<span class="string">"tutor_id = #&#123;tutorId&#125;"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; .toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里我们没有使用输入参数构造 SQL 语句，所以它可以是一个无参方法。<br>如果映射器 Mapper 接口方法只有一个参数，那么可以定义 SQL Provider 方法，它接受一个与 Mapper 接口方法相同类型的参数。<br>例如映射器 Mapper 接口有如下定义：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Tutor <span class="title">findTutorById</span><span class="params">(<span class="keyword">int</span> tutorId)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>这里 findTutorById(int)方法只有一个 int 类型的参数。我们可以定义 findTutorByIdSql(int)方法作为 SQLprovider 方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">findTutorByIdSql</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> tutorId)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> SQL()</span><br><span class="line">	&#123;</span><br><span class="line">		&#123;</span><br><span class="line">			SELECT(<span class="string">"tutor_id as tutorId, name, email"</span>);</span><br><span class="line">			FROM(<span class="string">"tutors"</span>);</span><br><span class="line">			WHERE(<span class="string">"tutor_id="</span> + tutorId);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; .toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果映射器 Mapper 接口有多个输入参数，我们可以使用参数类型为 java.util.Map 的方法作为 SQLprovider 方法。然后映射器 Mapper 接口方法所有的输入参数将会被放到 map 中，以 param1,param2 等等作为 key，将输入参数按序作为 value。 你也可以使用 0，1，2 等作为 key 值来取的输入参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SelectProvider</span>(type = TutorDynaSqlProvider.class,</span><br><span class="line">method = <span class="string">"findTutorByNameAndEmailSql"</span>)</span><br><span class="line"><span class="function">Tutor <span class="title">findTutorByNameAndEmail</span><span class="params">(String name, String email)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">findTutorByNameAndEmailSql</span><span class="params">(Map&lt;String, Object&gt; map)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	String name = (String) map.get(<span class="string">"param1"</span>);</span><br><span class="line">	String email = (String) map.get(<span class="string">"param2"</span>);</span><br><span class="line">	<span class="comment">//you can also get those values using 0,1 keys</span></span><br><span class="line">	<span class="comment">//String name = (String) map.get("0");</span></span><br><span class="line">	<span class="comment">//String email = (String) map.get("1");</span></span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> SQL()</span><br><span class="line">		&#123;</span><br><span class="line">			&#123;</span><br><span class="line">			SELECT(<span class="string">"tutor_id as tutorId, name, email"</span>);</span><br><span class="line">			FROM(<span class="string">"tutors"</span>);</span><br><span class="line">			WHERE(<span class="string">"name=#&#123;name&#125; AND email=#&#123;email&#125;"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; .toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SQL 工具类也提供了其他的方法来表示 JOINS，ORDER_BY，GROUP_BY 等等。<br>让我们看一个使用 LEFT_OUTER_JOIN 的例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TutorDynaSqlProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">selectTutorById</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SQL()</span><br><span class="line">		&#123;</span><br><span class="line">			&#123;</span><br><span class="line">				SELECT(<span class="string">"t.tutor_id, t.name as tutor_name, email"</span>);</span><br><span class="line">				SELECT(<span class="string">"a.addr_id, street, city, state, zip, country"</span>);</span><br><span class="line">				SELECT(<span class="string">"course_id, c.name as course_name, description,</span></span><br><span class="line"><span class="string">				start_date, end_date"</span>);</span><br><span class="line">				FROM(<span class="string">"TUTORS t"</span>);</span><br><span class="line">				LEFT_OUTER_JOIN(<span class="string">"addresses a on t.addr_id=a.addr_id"</span>);</span><br><span class="line">				LEFT_OUTER_JOIN(<span class="string">"courses c on t.tutor_id=c.tutor_id"</span>);</span><br><span class="line">				WHERE(<span class="string">"t.TUTOR_ID = #&#123;id&#125;"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; .toString();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TutorMapper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="meta">@SelectProvider</span>(type = TutorDynaSqlProvider.class,</span><br><span class="line">	method = <span class="string">"selectTutorById"</span>)</span><br><span class="line">	<span class="meta">@ResultMap</span>(<span class="string">"com.mybatis3.mappers.TutorMapper.TutorResult"</span>)</span><br><span class="line">	<span class="function">Tutor <span class="title">selectTutorById</span><span class="params">(<span class="keyword">int</span> tutorId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>由于没有支持使用内嵌结果 ResultMap 的一对多关联映射的注解支持，我们可以使用基于 XML 的<resultmap>配置，然后与@ResultMap 映射。</resultmap></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.mybatis3.mappers.TutorMapper"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Address"</span> <span class="attr">id</span>=<span class="string">"AddressResult"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"addr_id"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"street"</span> <span class="attr">column</span>=<span class="string">"street"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"city"</span> <span class="attr">column</span>=<span class="string">"city"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"state"</span> <span class="attr">column</span>=<span class="string">"state"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"zip"</span> <span class="attr">column</span>=<span class="string">"zip"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"country"</span> <span class="attr">column</span>=<span class="string">"country"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Course"</span> <span class="attr">id</span>=<span class="string">"CourseResult"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"course_id"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"course_name"</span> <span class="attr">property</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"description"</span> <span class="attr">property</span>=<span class="string">"description"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"start_date"</span> <span class="attr">property</span>=<span class="string">"startDate"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"end_date"</span> <span class="attr">property</span>=<span class="string">"endDate"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Tutor"</span> <span class="attr">id</span>=<span class="string">"TutorResult"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"tutor_id"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"tutor_name"</span> <span class="attr">property</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"email"</span> <span class="attr">property</span>=<span class="string">"email"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">resultMap</span>=<span class="string">"AddressResult"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"courses"</span> <span class="attr">resultMap</span>=<span class="string">"CourseResult"</span>&gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用了动态的 SQL provider，我们可以取得讲师及其地址和课程明细。</p>
<h3 id="InsertProvider"><a href="#InsertProvider" class="headerlink" title="@InsertProvider"></a>@InsertProvider</h3><p>我们可以使用@InsertProvider 注解创建动态的 INSERT 语句，如下所示：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TutorDynaSqlProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">insertTutor</span><span class="params">(<span class="keyword">final</span> Tutor tutor)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SQL()</span><br><span class="line">		&#123;</span><br><span class="line">			&#123;</span><br><span class="line">				INSERT_INTO(<span class="string">"TUTORS"</span>);</span><br><span class="line">				<span class="keyword">if</span> (tutor.getName() != <span class="keyword">null</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					VALUES(<span class="string">"NAME"</span>, <span class="string">"#&#123;name&#125;"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (tutor.getEmail() != <span class="keyword">null</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					VALUES(<span class="string">"EMAIL"</span>, <span class="string">"#&#123;email&#125;"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; .toString();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TutorMapper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="meta">@InsertProvider</span>(type = TutorDynaSqlProvider.class,</span><br><span class="line">method = <span class="string">"insertTutor"</span>)</span><br><span class="line"><span class="meta">@Options</span>(useGeneratedKeys = <span class="keyword">true</span>, keyProperty = <span class="string">"tutorId"</span>)</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insertTutor</span><span class="params">(Tutor tutor)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="UpdateProvider"><a href="#UpdateProvider" class="headerlink" title="@UpdateProvider"></a>@UpdateProvider</h3><p>我们可以通过@UpdateProvider 注解创建 UPDATE 语句，如下所示：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TutorDynaSqlProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">updateTutor</span><span class="params">(<span class="keyword">final</span> Tutor tutor)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> SQL()</span><br><span class="line">&#123;</span><br><span class="line">&#123;</span><br><span class="line">UPDATE(<span class="string">"TUTORS"</span>);</span><br><span class="line"><span class="keyword">if</span> (tutor.getName() != <span class="keyword">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">SET(<span class="string">"NAME = #&#123;name&#125;"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (tutor.getEmail() != <span class="keyword">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">SET(<span class="string">"EMAIL = #&#123;email&#125;"</span>);</span><br><span class="line">&#125;</span><br><span class="line">WHERE(<span class="string">"TUTOR_ID = #&#123;tutorId&#125;"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125; .toString();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TutorMapper</span></span></span><br><span class="line"><span class="class">	</span>&#123;</span><br><span class="line">	<span class="meta">@UpdateProvider</span>(type = TutorDynaSqlProvider.class,</span><br><span class="line">					method = <span class="string">"updateTutor"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">updateTutor</span><span class="params">(Tutor tutor)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="DeleteProvider"><a href="#DeleteProvider" class="headerlink" title="@DeleteProvider"></a>@DeleteProvider</h3><p>我们可以使用@DeleteProvider 注解创建动态地 DELETE 语句,如下所示：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TutorDynaSqlProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">deleteTutor</span><span class="params">(<span class="keyword">int</span> tutorId)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SQL()</span><br><span class="line">		&#123;</span><br><span class="line">			&#123;</span><br><span class="line">				DELETE_FROM(<span class="string">"TUTORS"</span>);</span><br><span class="line">				WHERE(<span class="string">"TUTOR_ID = #&#123;tutorId&#125;"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; .toString();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TutorMapper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="meta">@DeleteProvider</span>(type = TutorDynaSqlProvider.class,</span><br><span class="line">	method = <span class="string">"deleteTutor"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">deleteTutor</span><span class="params">(<span class="keyword">int</span> tutorId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="与Spring集成"><a href="#与Spring集成" class="headerlink" title="与Spring集成"></a>与Spring集成</h1><p>MyBatis-Spring 是 MyBatis 框架的子模块，用来提供与当前流行的依赖注入框架 Spring 的无缝集成。<br>Spring 框 架 是 一 个 基 于 依 赖 注 入 （ Dependency Injection ） 和 面 向 切 面 编 程 (Aspect Oriented Programming,AOP)的 Java 框架，鼓励使用基于 POJO 的编程模型。另外，Spring 提供了声明式和编程式的事务管理能力，可以很大程度上简化应用程序的数据访问层（data access layer）的实现。 在本章中，我们将看到在基于 Spring的应用程序中使用 MyBatis 并且使用 Spring 的基于注解的事务管理机制。<br>本章将包含以下话题：</p>
<ul>
<li>在 Spring 应用程序中配置 MyBatis</li>
<li>安装</li>
<li>配置 MyBatis Beans</li>
<li>使用 SqlSession</li>
<li>使用映射器</li>
<li>使用 Spring 进行事务管理</li>
</ul>
<h2 id="在-Spring-应用程序中配置-MyBatis"><a href="#在-Spring-应用程序中配置-MyBatis" class="headerlink" title="在 Spring 应用程序中配置 MyBatis"></a>在 Spring 应用程序中配置 MyBatis</h2><p>本节将讨论如何在基于 Spring 的应用程序中安装和配置 MyBatis</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>如果你正在使用 Maven 构建工具，你可以配置 MyBatis 的 spring 依赖如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjrt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib-nodep<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-dbcp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-dbcp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>如果你没有使用 Maven，你可以从 <a href="http://code.google.com/p/mybatis/" target="_blank" rel="noopener">http://code.google.com/p/mybatis/</a> 上下载 mybatis-spring-1.2.0-<br>boundle.zip。 将其加入，将 mybatis-1.2.0.jar 包添加到 classpath 中。<br>你可以从 <a href="http://www.springsource.org/download/community/" target="_blank" rel="noopener">http://www.springsource.org/download/community/</a> 上下载 Spring 框架包 spring-framework-3.1.3.RELEASE.zip。 将其内所有 jar 包添加到 classpath 中。<br>如果你只使用 MyBatis 而没有使用 Spring，在每一个方法中，我们需要手动创建 SqlSessionFactory 对象，并且从 SqlSessionFactory 对象中创建 SqlSession。 而且我们还要负责提交或者回滚事务、 关闭 SqlSession 对象。<br>通过使用 MyBatis-Spring 模块，我们可以在 Spring 的应用上下文 ApplicationContext 中配置 MyBatis<br>Beans,Spring 会负责实例化 SqlSessionFactory 对象以及创建 SqlSession 对象，并将其注入到 DAO 或者 Service类中。 并且，你可以使用 Spring 的基于注解的事务管理功能，不用自己在数据访问层中书写事务处理代码了。</p>
<h3 id="配置-MyBatis-Beans"><a href="#配置-MyBatis-Beans" class="headerlink" title="配置 MyBatis Beans"></a>配置 MyBatis Beans</h3><p>为了让 Spring 来实例化 MyBatis 组件如 SqlSessionFactory、 SqlSession、以及映射器 Mapper 对象，我们需要在 Spring 的 bean 配置文件中配置它们，假设在 applicationContext.xml 中，配配置如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource. DriverManagerDataSource"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/elearning"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"admin"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"typeAliases"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">value</span>=<span class="string">"com.mybatis3.domain.Student, com.mybatis3.domain.Tutor"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"typeAliasesPackage"</span> <span class="attr">value</span>=<span class="string">"com.mybatis3.domain"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"typeHandlers"</span> <span class="attr">value</span>=<span class="string">"com.mybatis3.typehandlers.PhoneTypeHandler"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"typeHandlersPackage"</span> <span class="attr">value</span>=<span class="string">"com.mybatis3.typehandlers"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapperLocations"</span> <span class="attr">value</span>=<span class="string">"classpath*:com/mybatis3/**/*.xml"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"WEB-INF/mybatisconfig.xml"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>使用上述的 bean 定义，Spring 会使用如下配置属性创建一个 SqlSessionFactory 对象：</p>
<ul>
<li>dataSource:它引用了 dataSource bean</li>
<li>typeAliases:它指定了一系列的完全限定名的类名列表，用逗号隔开，这些别名将通过默认的别名规则创建<br>（将首字母小写的非无完全限定类名作为别名）。</li>
<li>typeAliasesPackage:它指定了一系列包名列表，用逗号隔开，包内含有需要创建别名的 JavaBeans。</li>
<li>typeHandlers:它指定了一系列的类型处理器类的完全限定名的类名列表，用逗号隔开。</li>
<li>typeHandlersPackage: 它指定了一系列包名列表，用逗号隔开，包内含有需要被注册的类型处理器类。</li>
<li>mapperLocations:它指定了 SQL 映射器 Mapper XML 配置文件的位置</li>
<li>configLocation:它指定了 MyBatisSqlSessionFactory 配置文件所在的位置。</li>
</ul>
<h2 id="使用-SqlSession"><a href="#使用-SqlSession" class="headerlink" title="使用 SqlSession"></a>使用 SqlSession</h2><p>一旦 SqlSessionFactory bean 被配置，我们需要配置 SqlSessionTemplate bean，SqlSessionTemplate bean是一个线程安全的 Spring bean，我们可以从中获取到线程安全的 SqlSession 对象。由于 SqlSessionTemplate 提供线程安全的 SqlSession 对象，你可以在多个 Spring bean 实体对象中共享 SqlSessionTemplate 对象。 从概念上看，SqlSessionTemplate 和 Spring 的 DAO 模块中的 JdbcTemplate 非常相似。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSession"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionTemplate"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">ref</span>=<span class="string">"sqlSessionFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>现在我肯可以将 SqlSession bean 实体对象注射到任意的 Spring bean 实体中，然后使用 SqlSession 对象调用SQL 映射语句。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentDaoImpl</span> <span class="keyword">implements</span> <span class="title">StudentDao</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> SqlSession sqlSession;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSqlSession</span><span class="params">(SqlSession session)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		his.sqlSession = session;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createStudent</span><span class="params">(Student student)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		StudentMapper mapper =</span><br><span class="line">		<span class="keyword">this</span>.sqlSession.getMapper(StudentMapper.class);</span><br><span class="line">		mapper.insertStudent(student);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果你正在使用基于 XML 来配置 Spring beans,你可以将 SqlSession bean 实体对象注射到 StudenDaoImplbean 实体对象中，如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"studentDao"</span> <span class="attr">class</span>=<span class="string">"com.mybatis3.dao.StudentDaoImpl"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSession"</span> <span class="attr">ref</span>=<span class="string">"sqlSession"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>如果你使用基于注解的方式配置 Spring beans，你如下将 SqlSession bean 实体对象注入到 StudentDaoImpl bean 实体对象中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentDaoImpl</span> <span class="keyword">implements</span> <span class="title">StudentDao</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> SqlSession sqlSession;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSqlSession</span><span class="params">(SqlSession session)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.sqlSession = session;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createStudent</span><span class="params">(Student student)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		StudentMapper mapper = <span class="keyword">this</span>.sqlSession.getMapper(StudentMapper.class);</span><br><span class="line">		mapper.insertStudent(student);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还有另外一种注入 Sqlsession 对象的方法，即，通过拓展继承 SqlSessionDaoSupport。 这种方式让我们可以在执行映射语句时，加入任何自定义的逻辑。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentMapperImpl</span> <span class="keyword">extends</span> <span class="title">SqlSessionDaoSupport</span> <span class="keyword">implements</span></span></span><br><span class="line"><span class="class"><span class="title">StudentMapper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createStudent</span><span class="params">(Student student)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		StudentMapper mapper =</span><br><span class="line">		getSqlSession().getMapper(StudentMapper.class);</span><br><span class="line">		mapper.insertAddress(student.getAddress());</span><br><span class="line">		<span class="comment">//Custom logic</span></span><br><span class="line">		mapper.insertStudent(student);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"studentMapper"</span> <span class="attr">class</span>=<span class="string">"com.mybatis3.dao.StudentMapperImpl"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sqlSessionFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在以上的这些方式中，我们注入了 SqlSession 对象，获取 Mapper 实例，然后执行映射语句。这里 Spring 会为我们提供一个线程安全的 SqlSession 对象，以及当方法结束后关闭 SqlSession 对象。<br>然而，MyBatis-Spring 模块提供了更好的方式，我们可以不通过 SqlSession 获取映射器 Mapper，直接注射 Sql映射器 Mapper bean。我们下节将讨论它。</p>
<h2 id="使用映射器"><a href="#使用映射器" class="headerlink" title="使用映射器"></a>使用映射器</h2><p>我们可以使用 MapperFactoryBean 将映射器 Mapper 接口配置成 Spring bean 实体。 如下所示：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="meta">@Select</span>(<span class="string">"select stud_id as studId, name, email, phone from</span></span><br><span class="line"><span class="string">	students where stud_id=#&#123;id&#125;"</span>)</span><br><span class="line">	<span class="function">Student <span class="title">findStudentById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"studentMapper"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper. MapperFactoryBean"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapperInterface"</span> <span class="attr">value</span>=<span class="string">"com.mybatis3.mappers. StudentMapper"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sqlSessionFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>现在 StudentMapper bean 实体对象可以被注入到任意的 Spring bean 实体对象中，并调用映射语句方法，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentService</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> StudentMapper studentMapper;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStudentMapper</span> <span class="params">(StudentMapperstudentMapper)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">this</span>. studentMapper = studentMapper;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createStudent</span><span class="params">(Student student)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.studentMapper.insertStudent(student);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"studentService"</span> <span class="attr">class</span>=<span class="string">"com.mybatis3.services. StudentService"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"studentMapper"</span> <span class="attr">ref</span>=<span class="string">"studentMapper"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>分别配置每一个映射器 Mapper 接口是一个非常单调的过程。我们可以使用 MapperScannerConfigurer 来扫描包（package）中的映射器 Mapper 接口，并自动地注册。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.mybatis3.mappers"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果映射器 Mapper 接口在不同的包(package)中，你可以为 basePackage 属性指定一个以逗号分隔的包名列表。<br>MyBatis-Spring-1.2.0 介绍了两种新的扫描映射器 Mapper 接口的方法：</p>
<ul>
<li>使用<a href="mybatis:scan/" target="_blank" rel="noopener">mybatis:scan/</a>元素</li>
<li>使用@MapperScan 注解（需 Spring3.1+版本）</li>
</ul>
</blockquote>
<h3 id="lt-mybatis-scan-gt"><a href="#lt-mybatis-scan-gt" class="headerlink" title="&lt;mybatis:scan /&gt;"></a>&lt;mybatis:scan /&gt;</h3><p><code>&lt;mybatis:scan&gt;</code>元素将在特定的以逗号分隔的包名列表中搜索映射器 Mapper 接口。 使用这个新的 MyBatisSpring 名空间你需要添加以下的 schema 声明：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:mybatis</span>=<span class="string">"http://mybatis.org/schema/mybatis-spring"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://mybatis.org/schema/mybatis-spring</span></span></span><br><span class="line"><span class="tag"><span class="string">http://mybatis.org/schema/mybatis-spring.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">mybatis:scan</span> <span class="attr">base-package</span>=<span class="string">"com.mybatis3.mappers"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><a href="mybatis:scan" target="_blank" rel="noopener">mybatis:scan</a>元素提供了下列的属性来自定义扫描过程：</p>
<ul>
<li>annotation: 扫描器将注册所有的在 base-package 包内并且匹配指定注解的映射器 Mapper 接口。</li>
<li>factory-ref: 当 Spring 上 下 文 中 有 多 个 SqlSessionFactory 实 例 时 ， 需 要 指 定 某 一 特 定 的SqlSessionFactory 来创建映射器 Mapper 接口。正常情况下，只有应用程序中有一个以上的数据源<br>才会使用。</li>
<li>marker-interface: 扫描器将注册在 base-package 包中的并且继承了特定的接口类的映射器 Mapper 接<br>口</li>
<li>template-ref: 当 Spring 上下文中有多个 SqlSessionTemplate 实例时，需要指定某一特定的<br>SqlSessionTemplate 来创建映射器 Mapper 接口。 正常情况下，只有应用程序中有一个以上的数据源<br>才会使用。</li>
<li>name-generator:BeannameGenerator 类的完全限定类名，用来命名检测到的组件。</li>
</ul>
<h3 id="MapperScan"><a href="#MapperScan" class="headerlink" title="MapperScan"></a>MapperScan</h3><p>Spring 框架 3.x+版本支持使用@Configuration 和@Bean 注解来提供基于 Java 的配置。如果你倾向于使用基于Java 的配置，你可以使用@MapperScan 注解来扫描映射器 Mapper 接口。 @MapperScan 和<a href="mybatis:scan/" target="_blank" rel="noopener">mybatis:scan/</a>工作方式相同，并且也提供了对应的自定义选项。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan</span>(<span class="string">"com.mybatis3.mappers"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> PooledDataSource(<span class="string">"com.mysql.jdbc.Driver"</span>,</span><br><span class="line">								<span class="string">"jdbc:mysql://localhost:3306/elearning"</span>, <span class="string">"root"</span>, <span class="string">"admin"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">sqlSessionFactory</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		SqlSessionFactoryBeansessionFactory = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">		sessionFactory.setDataSource(dataSource());</span><br><span class="line">		<span class="keyword">return</span> sessionFactory.getObject();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@MapperScan 注解有以下属性供自定义扫描过程使用:</p>
<ul>
<li>annotationClass: 扫描器将注册所有的在 base-package 包内并且匹配指定注解的映射器 Mapper 接口。</li>
<li>markerInterface: 扫描器将注册在 base-package 包中的并且继承了特定的接口类的映射器 Mapper 接口</li>
<li>sqlSessionFactoryRef:当 Spring 上 下 文 中 有 一 个以 上 的 SqlSesssionFactory 时 ， 用 来 指 定 特 定SqlSessionFactory</li>
<li>sqlSessionTemplateRef: 当 Spring 上下文中有一个以上的 sqlSessionTemplate 时，用来指定特定<br>sqlSessionTemplate</li>
<li>nameGenerator:BeanNameGenerator 类用来命名在 Spring 容器内检测到的组件。</li>
<li>basePackageClasses:basePackages()的类型安全的替代品。 包内的每一个类都会被扫描。</li>
<li>basePackages:扫描器扫描的基包，扫描器会扫描内部的 Mapper 接口。 注意包内的至少有一个方法声明的才会被<br>注册。 具体类将会被忽略。<blockquote>
<p>与注入 Sqlsession 相比，更推荐使用注入 Mapper，因为它摆脱了对MyBatis API 的依赖。</p>
</blockquote>
</li>
</ul>
<h2 id="使用Spring进行事务管理"><a href="#使用Spring进行事务管理" class="headerlink" title="使用Spring进行事务管理"></a>使用Spring进行事务管理</h2><p>只使用 MyBatis，你需要写事务控制相关代码，如提交或者回退数据库操作。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Student <span class="title">createStudent</span><span class="params">(Student student)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	SqlSession sqlSession = MyBatisUtil.getSqlSessionFactory().openSession();</span><br><span class="line">	<span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);</span><br><span class="line">		mapper.insertAddress(student.getAddress());</span><br><span class="line">		mapper.insertStudent(student);</span><br><span class="line">		sqlSession.commit();</span><br><span class="line">		<span class="keyword">return</span> student;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (Exception e)</span><br><span class="line">	&#123;</span><br><span class="line">		sqlSession.rollback();</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">finally</span></span><br><span class="line">	&#123;</span><br><span class="line">		sqlSession.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我们可以使用 Spring 的基于注解的事务处理机制来避免书写上述的每个方法中控制事务的冗余代码。<br>为了能使用 Spring 的事务管理功能，我们需要在 Spring 应用上下文中配置 TransactionManager bean 实体对象：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">class</span>=<span class="string">"org.springframework.jdbc. datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>事务管理器引用的 dataSource 和 SqlSessionFactory bean 使用的 dataSource 相同。<br>在 Spring 中使用基于注解的事务管理特性，如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>现在你可以在 Spring service bean 上使用@Transactional 注解，表示在此 service 中的每一个方法都应该在一个事务中运行。 如果方法成功运行完毕，Spring 会提交操作。如果有运行期异常发生，则会执行回滚操作。 另外，Spring 会将 MyBatis 的异常转换成合适的 DataAccessExceptions，这样会为特定错误上提供额外的信息。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Service</span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentService</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> StudentMapper studentMapper;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Student <span class="title">createStudent</span><span class="params">(Student student)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		studentMapper.insertAddress(student.getAddress());</span><br><span class="line">		<span class="keyword">if</span>(student.getName().equalsIgnoreCase(<span class="string">""</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Student name should not be empty."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	studentMapper.insertStudent(student);</span><br><span class="line">	<span class="keyword">return</span> student;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下面是一个 Spring 的 applicationContext.xml 完成配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:annotation-config</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.mybatis3"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:application.properties"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.mybatis3.mappers"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSession"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionTemplate"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">ref</span>=<span class="string">"sqlSessionFactory"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"typeAliases"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">value</span>=<span class="string">"com.mybatis3.domain.Student,com.mybatis3.domain.Tutor"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"typeAliasesPackage"</span> <span class="attr">value</span>=<span class="string">"com.mybatis3.domain"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"typeHandlers"</span> <span class="attr">value</span>=<span class="string">"com.mybatis3.typehandlers.PhoneTypeHandler"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"typeHandlersPackage"</span> <span class="attr">value</span>=<span class="string">"com.mybatis3.typehandlers"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapperLocations"</span> <span class="attr">value</span>=<span class="string">"classpath*:com/mybatis3/**/*.xml"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driverClassName&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>现在让我们写一个独立的测试客户端来测试 StudentService，如下:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(locations = <span class="string">"classpath:applicationContext.xml"</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentServiceTest</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> StudentService studentService;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCreateStudent</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Address address = <span class="keyword">new</span> Address(<span class="number">0</span>, <span class="string">"Quaker Ridge</span></span><br><span class="line"><span class="string">Rd."</span>, <span class="string">"Bethel"</span>, <span class="string">"Brooklyn"</span>, <span class="string">"06801"</span>, <span class="string">"USA"</span>);</span><br><span class="line">Student stud = <span class="keyword">new</span> Student();</span><br><span class="line"><span class="keyword">long</span> ts = System.currentTimeMillis();</span><br><span class="line">stud.setName(<span class="string">"stud_"</span> + ts);</span><br><span class="line">stud.setEmail(<span class="string">"stud_"</span> + ts + <span class="string">"@gmail.com"</span>);</span><br><span class="line">stud.setAddress(address);</span><br><span class="line">Student student = studentService.createStudent(stud);</span><br><span class="line">assertNotNull(student);</span><br><span class="line">assertEquals(<span class="string">"stud_"</span> + ts, student.getName());</span><br><span class="line">assertEquals(<span class="string">"stud_"</span> + ts + <span class="string">"@gmail.com"</span>, student.getEmail());</span><br><span class="line">System.err.println(<span class="string">"CreatedStudent: "</span> + student);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Test</span>(expected = DataAccessException.class)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCreateStudentForException</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Address address = <span class="keyword">new</span> Address(<span class="number">0</span>, <span class="string">"Quaker Ridge</span></span><br><span class="line"><span class="string">Rd."</span>, <span class="string">"Bethel"</span>, <span class="string">"Brooklyn"</span>, <span class="string">"06801"</span>, <span class="string">"USA"</span>);</span><br><span class="line">Student stud = <span class="keyword">new</span> Student();</span><br><span class="line"><span class="keyword">long</span> ts = System.currentTimeMillis();</span><br><span class="line">stud.setName(<span class="string">"Timothy"</span>);</span><br><span class="line">stud.setEmail(<span class="string">"stud_"</span> + ts + <span class="string">"@gmail.com"</span>);</span><br><span class="line">stud.setAddress(address);</span><br><span class="line">studentService.createStudent(stud);</span><br><span class="line">fail(<span class="string">"You should not reach here"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里在 testCreateStudent()方法中，我们为 Address 和 Student 赋上了合适的数据，所以 Address 和 Student会被分别插入到表 ADDRESSES 和 STUDENTS 中。在 testCreateStudentForException()方法我们设置了名字为Timothy，该名称在数据库中已经存在了，所以当你尝试将此 student 记录插入到数据库中，MySQL 会抛出一个 UNIQUEKEY 冲突的异常，Spring 会将此异常转换成 DataAccessException 异常，并且将插入 ADDRESSES 表中的数据回滚（rollback）掉。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在本章中我们学习了怎样将 MyBatis 与 Spring 框架集成。我们还学习了怎样安装 Spring 类库并且在 Spring 的应用上下文 ApplicationContext 上注册 MyBatis bean 实体对象。我们还看到怎样配置和注入 SqlSession 和 Mapper bean 实体对象以及调用映射语句。我们还学习了利用 Spring 基于注解的事务处理机制来使用 MyBatis。<br>你已经读完本书，祝贺你！现在，你应该知道怎样高效地使用 MyBatis 与数据库工作。 你学会了怎样发挥你的 Java 和 SQL 技巧的优势使 MyBatis 更富有成效。你知道了怎样以更清晰的方式使用 MyBatis 写出数据持久化代码，不用管被 MyBatis 框架处理的所有底层细节。 另外，你学会了怎样在最流行的依赖注入框架-Spring 中使用 MyBatis。<br>MyBatis 框架非常易于使用，但它提供了强大的特性，因此它对于基于 Java 的项目而言，是一个非常好的数据库持久化解决方案。 MyBatis 也提供了一些工具如 MyBatis Generator(<a href="http://www.mybatis.org/generator/)，可以被用来从已经存在的数据库" target="_blank" rel="noopener">http://www.mybatis.org/generator/)，可以被用来从已经存在的数据库</a> schema 中，产生持久化代码如数据库实体（database entities）,映射器 Mapper 接口，MapperXML 配置文件，使 MyBatis 入门非常方便。 另外，MyBatis 还有它的姊妹项目如 MyBatis.NET 和 MyBatisScala，分别为.NET 和 Scala 编程语言提供了一样强大的特性。<br>MyBatis 随着每一个版本的发布，增加了一些特性，正变得越来越好。 想了解更多的新特性，你可以访问 MyBatis官方网站 <a href="https://code.google.com/p/mybatis/" target="_blank" rel="noopener">https://code.google.com/p/mybatis/</a> .订阅 MyBatis 的使用者邮件列表是一个不错的想法。 </p>

        </div>
        <footer class="article-footer">
            



    <a data-url="https://skiyubon.github.io/2017/04/13/MyBatis/" data-id="cjfksoywv002a6kprc35c52uy" class="article-share-link"><i class="fa fa-share"></i>article.share</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>


                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>sidebar.follow:</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="twitter" href="/" target="_blank">
                        <i class="icon fa fa-twitter"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="facebook" href="/" target="_blank">
                        <i class="icon fa fa-facebook"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="google-plus" href="/" target="_blank">
                        <i class="icon fa fa-google-plus"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/ppoffice/hexo-theme-hueman" target="_blank">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="weibo" href="/" target="_blank">
                        <i class="icon fa fa-weibo"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="rss" href="/" target="_blank">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2017/04/17/架构漫谈（一）：什么是架构/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">sidebar.newer</strong>
        <p class="article-nav-title">
        
            架构漫谈（一）：什么是架构
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/2017/04/12/SpringMVC详解/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">sidebar.older</strong>
        <p class="article-nav-title">SpringMVC详解</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                

            
                
    <div class="widget-wrap">
        <h3 class="widget-title">sidebar.recents</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/04/04/hello-world/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/04/04/hello-world/" class="title">Hello World</a></p>
                            <p class="item-date"><time datetime="2018-04-04T03:05:49.209Z" itemprop="datePublished">2018-04-04</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/04/04/oop/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/04/04/oop/" class="title">oop</a></p>
                            <p class="item-date"><time datetime="2018-04-04T01:48:06.000Z" itemprop="datePublished">2018-04-04</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/07/17/元数据驱动设计/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2017/07/17/元数据驱动设计/" class="title">元数据驱动设计</a></p>
                            <p class="item-date"><time datetime="2017-07-17T02:15:07.000Z" itemprop="datePublished">2017-07-17</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/07/10/Spring-容器/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Java/">Java</a></p>
                            <p class="item-title"><a href="/2017/07/10/Spring-容器/" class="title">Spring 容器</a></p>
                            <p class="item-date"><time datetime="2017-07-10T08:14:04.000Z" itemprop="datePublished">2017-07-10</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/06/26/fastjson/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Java/">Java</a></p>
                            <p class="item-title"><a href="/2017/06/26/fastjson/" class="title">fastjson</a></p>
                            <p class="item-date"><time datetime="2017-06-26T03:49:07.000Z" itemprop="datePublished">2017-06-26</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">sidebar.categories</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Cache/">Cache</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JS/">JS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaWeb/">JavaWeb</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Security/">Security</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tool/">Tool</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据/">大数据</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件架构/">软件架构</a><span class="category-list-count">1</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">sidebar.archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a><span class="archive-list-count">13</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">sidebar.tags</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Analyzer/">Analyzer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java基础/">Java基础</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lucene/">Lucene</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MyBatis/">MyBatis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node-js/">Node.js</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OOP/">OOP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/">Redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shiro/">Shiro</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/">Spring</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringMVC/">SpringMVC</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tool/">Tool</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fastjson/">fastjson</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/软件架构/">软件架构</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/软件设计/">软件设计</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">sidebar.tag_cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/Analyzer/" style="font-size: 10px;">Analyzer</a> <a href="/tags/Java基础/" style="font-size: 10px;">Java基础</a> <a href="/tags/Lucene/" style="font-size: 20px;">Lucene</a> <a href="/tags/MyBatis/" style="font-size: 10px;">MyBatis</a> <a href="/tags/Node-js/" style="font-size: 10px;">Node.js</a> <a href="/tags/OOP/" style="font-size: 10px;">OOP</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Shiro/" style="font-size: 10px;">Shiro</a> <a href="/tags/Spring/" style="font-size: 10px;">Spring</a> <a href="/tags/SpringMVC/" style="font-size: 15px;">SpringMVC</a> <a href="/tags/Tool/" style="font-size: 15px;">Tool</a> <a href="/tags/fastjson/" style="font-size: 10px;">fastjson</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/软件架构/" style="font-size: 10px;">软件架构</a> <a href="/tags/软件设计/" style="font-size: 10px;">软件设计</a>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">sidebar.links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>
                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2018 WUZHOU</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_shortname = 'hexo-theme-hueman';
    
    
    var disqus_url = 'https://skiyubon.github.io/2017/04/13/MyBatis/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>
